var J=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var D=(C,l,d)=>l in C?J(C,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):C[l]=d,N=(C,l)=>{for(var d in l||(l={}))Y.call(l,d)&&D(C,d,l[d]);if(O)for(var d of O(l))Z.call(l,d)&&D(C,d,l[d]);return C},H=(C,l)=>Q(C,X(l));var y=(C,l,d)=>new Promise((i,v)=>{var p=r=>{try{a(d.next(r))}catch(k){v(k)}},h=r=>{try{a(d.throw(r))}catch(k){v(k)}},a=r=>r.done?i(r.value):Promise.resolve(r.value).then(p,h);a((d=d.apply(C,l)).next())});import{_ as F,r as m,e as z,c as f,o as g,b as e,k as _,v as w,m as T,F as L,a as A,n as I,t as U,i as q,f as E,p as R,q as P,w as G,d as B,l as K,s as ee,u as j}from"./index-wynVcSD0.js";import{a as W,f as te,u as le,h as se,i as ne,j as ae,k as oe,l as ie,m as ue,n as de,d as re,b as ce,o as ve,p as pe,q as me,c as ge,r as he,s as be,t as _e,v as fe,w as we,x as ke,y as $e,g as ye,z as Me,A as Ce}from"./api-CPdfUet4.js";const Ue={class:"menu-manage"},Ve={class:"menu-header"},xe={class:"menu-add"},Be={class:"menu-content"},Se={class:"menu-list"},Ie={class:"main-menu"},Le={class:"menu-info"},Ae=["onUpdate:modelValue","onBlur"],Fe={class:"menu-order"},je=["onUpdate:modelValue","onBlur"],Te={class:"menu-actions"},ze=["onClick","title"],Ne=["onClick"],Pe={class:"sub-menu-header"},He={class:"sub-menu-title"},Re=["onClick"],Oe={key:0,class:"sub-menu-list"},De={class:"sub-menu-info"},Ee=["onUpdate:modelValue","onBlur"],Ke={class:"sub-menu-order"},qe=["onUpdate:modelValue","onBlur"],Ge={class:"sub-menu-actions"},We=["onClick"],Je={key:1,class:"empty-sub-menu"},Qe=["onClick"],Xe={__name:"MenuManage",setup(C){const l=m([]),d=m("");z(i);function i(){return y(this,null,function*(){const t=yield W();l.value=t.data.map(s=>H(N({},s),{showSubMenu:!1}))})}function v(){return y(this,null,function*(){if(!d.value.trim())return;const t=l.value.length?Math.max(...l.value.map(s=>s.order||0)):0;yield te({name:d.value.trim(),order:t+1}),d.value="",i()})}function p(t){return y(this,null,function*(){yield le(t.id,{name:t.name,order:t.order}),i()})}function h(t){return y(this,null,function*(){confirm("确定要删除这个主菜单吗？删除后将同时删除其下的所有子菜单和卡片。")&&(yield se(t),i())})}function a(t){return y(this,null,function*(){var $;const s=l.value.find(M=>M.id===t),o=prompt("请输入子菜单名称：");if(!(o!=null&&o.trim()))return;const x=($=s.subMenus)!=null&&$.length?Math.max(...s.subMenus.map(M=>M.order||0)):0;yield ne(t,{name:o.trim(),order:x+1}),i()})}function r(t){return y(this,null,function*(){yield ae(t.id,{name:t.name,order:t.order}),i()})}function k(t){return y(this,null,function*(){confirm("确定要删除这个子菜单吗？删除后将同时删除其下的所有卡片。")&&(yield oe(t),i())})}function c(t){const s=l.value.find(o=>o.id===t);s&&(s.showSubMenu=!s.showSubMenu)}return(t,s)=>(g(),f("div",Ue,[e("div",Ve,[s[2]||(s[2]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理主菜单和子菜单")],-1)),e("div",xe,[_(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>d.value=o),placeholder:"请输入主菜单名称",class:"input"},null,512),[[w,d.value]]),e("button",{class:"btn btn-primary",onClick:v},s[1]||(s[1]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),T(" 添加主菜单 ")]))])]),e("div",Be,[e("div",Se,[(g(!0),f(L,null,A(l.value,o=>{var x;return g(),f("div",{key:o.id,class:"menu-item"},[e("div",Ie,[e("div",Le,[s[4]||(s[4]=e("div",{class:"menu-icon"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 3h18v18H3zM9 9h6v6H9z"})])],-1)),_(e("input",{"onUpdate:modelValue":$=>o.name=$,onBlur:$=>p(o),class:"menu-name-input"},null,40,Ae),[[w,o.name]]),e("div",Fe,[s[3]||(s[3]=e("span",{class:"order-label"},"排序",-1)),_(e("input",{"onUpdate:modelValue":$=>o.order=$,type:"number",onBlur:$=>p(o),class:"order-input"},null,40,je),[[w,o.order,void 0,{number:!0}]])])]),e("div",Te,[e("button",{class:"btn btn-icon expand-btn",onClick:$=>c(o.id),title:o.showSubMenu?"收起子菜单":"展开子菜单"},s[5]||(s[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m6 9 6 6 6-6"})],-1)]),8,ze),e("button",{class:"btn btn-danger btn-icon",onClick:$=>h(o.id),title:"删除主菜单"},s[6]||(s[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,Ne)])]),e("div",{class:I(["sub-menu-section",{expanded:o.showSubMenu}])},[e("div",Pe,[e("div",He,[s[7]||(s[7]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 11H1l8-8 8 8h-8v8z"})],-1)),T(" 子菜单 ("+U(((x=o.subMenus)==null?void 0:x.length)||0)+") ",1)]),e("button",{class:"btn btn-sm btn-outline",onClick:$=>a(o.id)},s[8]||(s[8]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),T(" 添加子菜单 ")]),8,Re)]),o.subMenus&&o.subMenus.length>0?(g(),f("div",Oe,[(g(!0),f(L,null,A(o.subMenus,$=>(g(),f("div",{key:$.id,class:"sub-menu-item"},[e("div",De,[s[9]||(s[9]=e("div",{class:"sub-menu-icon"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 6h16M4 12h16M4 18h16"})])],-1)),_(e("input",{"onUpdate:modelValue":M=>$.name=M,onBlur:M=>r($),class:"sub-menu-name-input"},null,40,Ee),[[w,$.name]]),e("div",Ke,[_(e("input",{"onUpdate:modelValue":M=>$.order=M,type:"number",onBlur:M=>r($),class:"order-input"},null,40,qe),[[w,$.order,void 0,{number:!0}]])])]),e("div",Ge,[e("button",{class:"btn btn-danger btn-icon btn-sm",onClick:M=>k($.id),title:"删除子菜单"},s[10]||(s[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 22 22",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,We)])]))),128))])):(g(),f("div",Je,[s[11]||(s[11]=e("p",null,"暂无子菜单",-1)),e("button",{class:"btn btn-sm btn-outline",onClick:$=>a(o.id)},"添加第一个子菜单",8,Qe)]))],2)])}),128))])])]))}},Ye=F(Xe,[["__scopeId","data-v-5964fa59"]]),Ze={class:"card-manage"},et={class:"card-header"},tt={class:"card-add"},lt=["value"],st=["value"],nt={class:"input-with-icon header-icon-input"},at={class:"card-card"},ot={class:"cell"},it=["onUpdate:modelValue","onBlur"],ut={class:"cell"},dt=["onUpdate:modelValue","onBlur"],rt={class:"cell"},ct={class:"input-with-icon row-icon-input"},vt=["onUpdate:modelValue","onBlur"],pt=["onClick"],mt={class:"cell"},gt=["onUpdate:modelValue","onBlur"],ht={class:"cell"},bt=["onUpdate:modelValue","onBlur"],_t={class:"cell cell-action"},ft=["onClick"],wt={__name:"CardManage",setup(C){const l=m([]),d=m([]),i=m(),v=m(""),p=m(""),h=m(""),a=m(""),r=q(()=>{if(!i.value)return[];const b=l.value.find(n=>n.id===i.value);return(b==null?void 0:b.subMenus)||[]});z(()=>y(null,null,function*(){const b=yield W();l.value=b.data,l.value.length&&(i.value=l.value[0].id,v.value="")})),E(i,()=>{v.value="",t()}),E(v,t);function k(){v.value=""}function c(){t()}function t(){return y(this,null,function*(){if(!i.value)return;const b=yield re(i.value,v.value||null);d.value=b.data})}function s(){return y(this,null,function*(){!p.value||!h.value||(yield ie({menu_id:i.value,sub_menu_id:v.value||null,title:p.value,url:h.value,logo_url:a.value}),p.value="",h.value="",a.value="",t())})}function o(b){return y(this,null,function*(){yield ue(b.id,{menu_id:i.value,sub_menu_id:v.value||null,title:b.title,url:b.url,logo_url:b.logo_url,desc:b.desc,order:b.order})})}function x(b){return y(this,null,function*(){yield de(b),t()})}function $(b){if(!b)return null;try{let n=b;return/^https?:\/\//i.test(n)||(n="http://"+n),new URL(n).hostname.replace(/^www\./i,"")}catch(n){return null}}function M(){const b=$(h.value);b?a.value=`https://www.faviconextractor.com/favicon/${b}?larger=true`:alert("请先在“卡片链接”中输入有效的 URL")}function S(b){return y(this,null,function*(){const n=$(b.url);if(n){b.logo_url=`https://www.faviconextractor.com/favicon/${n}?larger=true`;try{yield o(b)}catch(u){alert("获取图标成功，但自动保存失败。")}}else alert("此卡片的 URL 无效，无法获取图标。")})}return(b,n)=>(g(),f("div",Ze,[e("div",et,[n[8]||(n[8]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理网站导航卡片，支持主菜单和子菜单分类")],-1)),e("div",tt,[_(e("select",{"onUpdate:modelValue":n[0]||(n[0]=u=>i.value=u),class:"input",onChange:k},[(g(!0),f(L,null,A(l.value,u=>(g(),f("option",{value:u.id,key:u.id},U(u.name),9,lt))),128))],544),[[R,i.value]]),_(e("select",{"onUpdate:modelValue":n[1]||(n[1]=u=>v.value=u),class:"input",onChange:c},[n[5]||(n[5]=e("option",{value:""},"主菜单",-1)),(g(!0),f(L,null,A(r.value,u=>(g(),f("option",{value:u.id,key:u.id},U(u.name),9,st))),128))],544),[[R,v.value]]),_(e("input",{"onUpdate:modelValue":n[2]||(n[2]=u=>p.value=u),placeholder:"卡片标题",class:"input"},null,512),[[w,p.value]]),_(e("input",{"onUpdate:modelValue":n[3]||(n[3]=u=>h.value=u),placeholder:"卡片链接",class:"input"},null,512),[[w,h.value]]),e("div",nt,[_(e("input",{"onUpdate:modelValue":n[4]||(n[4]=u=>a.value=u),placeholder:"logo链接(可选)",class:"input"},null,512),[[w,a.value]]),e("button",{class:"btn btn-icon btn-magic",onClick:M,title:"自动获取图标"},n[6]||(n[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]))]),e("button",{class:"btn btn-add",onClick:s},n[7]||(n[7]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),T(" 添加卡片 ")]))])]),e("div",at,[n[11]||(n[11]=P('<div class="card-row card-row-header" data-v-17a39c31><div class="cell cell-label" data-v-17a39c31>标题</div><div class="cell cell-label" data-v-17a39c31>网址</div><div class="cell cell-label" data-v-17a39c31>Logo链接</div><div class="cell cell-label" data-v-17a39c31>描述</div><div class="cell cell-label" data-v-17a39c31>排序</div><div class="cell cell-label cell-label-action" data-v-17a39c31>操作</div></div>',1)),(g(!0),f(L,null,A(d.value,u=>(g(),f("div",{class:"card-row",key:u.id},[e("div",ot,[_(e("input",{"onUpdate:modelValue":V=>u.title=V,onBlur:V=>o(u),class:"table-input"},null,40,it),[[w,u.title]])]),e("div",ut,[_(e("input",{"onUpdate:modelValue":V=>u.url=V,onBlur:V=>o(u),class:"table-input"},null,40,dt),[[w,u.url]])]),e("div",rt,[e("div",ct,[_(e("input",{"onUpdate:modelValue":V=>u.logo_url=V,onBlur:V=>o(u),class:"table-input",placeholder:"logo链接(可选)"},null,40,vt),[[w,u.logo_url]]),e("button",{class:"btn btn-icon btn-magic",onClick:V=>S(u),title:"自动获取图标"},n[9]||(n[9]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]),8,pt)])]),e("div",mt,[_(e("input",{"onUpdate:modelValue":V=>u.desc=V,onBlur:V=>o(u),class:"table-input",placeholder:"描述（可选）"},null,40,gt),[[w,u.desc]])]),e("div",ht,[_(e("input",{"onUpdate:modelValue":V=>u.order=V,type:"number",onBlur:V=>o(u),class:"table-input"},null,40,bt),[[w,u.order,void 0,{number:!0}]])]),e("div",_t,[e("button",{class:"btn btn-danger btn-icon",onClick:V=>x(u.id),title:"删除"},n[10]||(n[10]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,ft)])]))),128))])]))}},kt=F(wt,[["__scopeId","data-v-17a39c31"]]),$t={class:"ad-manage"},yt={class:"ad-header"},Mt={class:"ad-section"},Ct={class:"ad-card"},Ut={class:"ad-table"},Vt=["onUpdate:modelValue","onBlur"],xt=["onUpdate:modelValue","onBlur"],Bt=["onClick"],St={class:"ad-section"},It={class:"ad-card"},Lt={class:"ad-table"},At=["onUpdate:modelValue","onBlur"],Ft=["onUpdate:modelValue","onBlur"],jt=["onClick"],Tt={__name:"AdManage",setup(C){const l=m([]),d=m([]),i=m(""),v=m(""),p=m("left");z(h);function h(){return y(this,null,function*(){const c=yield ce();l.value=c.data.filter(t=>t.position==="left"),d.value=c.data.filter(t=>t.position==="right")})}function a(){return y(this,null,function*(){!i.value||!v.value||(yield ve({position:p.value,img:i.value,url:v.value}),i.value="",v.value="",p.value="left",h())})}function r(c){return y(this,null,function*(){yield pe(c.id,{img:c.img,url:c.url}),h()})}function k(c){return y(this,null,function*(){yield me(c),h()})}return(c,t)=>(g(),f("div",$t,[e("div",yt,[e("form",{class:"ad-add-row",onSubmit:G(a,["prevent"])},[_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),placeholder:"广告图片链接",class:"input"},null,512),[[w,i.value]]),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),placeholder:"广告跳转链接",class:"input"},null,512),[[w,v.value]]),_(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>p.value=s),class:"input select-input"},t[3]||(t[3]=[e("option",{value:"left"},"左侧广告",-1),e("option",{value:"right"},"右侧广告",-1)]),512),[[R,p.value]]),t[4]||(t[4]=e("button",{class:"btn",type:"submit"},"添加广告",-1))],32)]),e("div",Mt,[t[6]||(t[6]=e("h3",{class:"section-title"},"左侧广告列表",-1)),e("div",Ct,[e("table",Ut,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(g(!0),f(L,null,A(l.value,s=>(g(),f("tr",{key:s.id},[e("td",null,[_(e("input",{"onUpdate:modelValue":o=>s.img=o,onBlur:o=>r(s),class:"input"},null,40,Vt),[[w,s.img]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":o=>s.url=o,onBlur:o=>r(s),class:"input"},null,40,xt),[[w,s.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:o=>k(s.id)},"删除广告",8,Bt)])]))),128))])])])]),e("div",St,[t[8]||(t[8]=e("h3",{class:"section-title"},"右侧广告列表",-1)),e("div",It,[e("table",Lt,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(g(!0),f(L,null,A(d.value,s=>(g(),f("tr",{key:s.id},[e("td",null,[_(e("input",{"onUpdate:modelValue":o=>s.img=o,onBlur:o=>r(s),class:"input"},null,40,At),[[w,s.img]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":o=>s.url=o,onBlur:o=>r(s),class:"input"},null,40,Ft),[[w,s.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:o=>k(s.id)},"删除广告",8,jt)])]))),128))])])])])]))}},zt=F(Tt,[["__scopeId","data-v-780b5e23"]]),Nt={class:"friend-manage"},Pt={class:"friend-add"},Ht={class:"friend-card"},Rt={class:"friend-table"},Ot=["onUpdate:modelValue","onBlur"],Dt=["onUpdate:modelValue","onBlur"],Et=["onUpdate:modelValue","onBlur"],Kt=["onClick"],qt={__name:"FriendLinkManage",setup(C){const l=m([]),d=m(""),i=m(""),v=m("");z(p);function p(){return y(this,null,function*(){const k=yield ge();l.value=k.data})}function h(){return y(this,null,function*(){!d.value||!i.value||(yield he({title:d.value,url:i.value,logo:v.value}),d.value="",i.value="",v.value="",p())})}function a(k){return y(this,null,function*(){yield be(k.id,{title:k.title,url:k.url,logo:k.logo}),p()})}function r(k){return y(this,null,function*(){yield _e(k),p()})}return(k,c)=>(g(),f("div",Nt,[c[4]||(c[4]=e("div",{class:"friend-header"},null,-1)),e("div",Pt,[_(e("input",{"onUpdate:modelValue":c[0]||(c[0]=t=>d.value=t),placeholder:"网站名",class:"input"},null,512),[[w,d.value]]),_(e("input",{"onUpdate:modelValue":c[1]||(c[1]=t=>i.value=t),placeholder:"网站链接",class:"input"},null,512),[[w,i.value]]),_(e("input",{"onUpdate:modelValue":c[2]||(c[2]=t=>v.value=t),placeholder:"logo链接(可选)",class:"input"},null,512),[[w,v.value]]),e("button",{class:"btn",onClick:h},"添加友链")]),e("div",Ht,[e("table",Rt,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",null,"网站名"),e("th",null,"链接"),e("th",null,"Logo"),e("th",null,"操作")])],-1)),e("tbody",null,[(g(!0),f(L,null,A(l.value,t=>(g(),f("tr",{key:t.id},[e("td",null,[_(e("input",{"onUpdate:modelValue":s=>t.title=s,onBlur:s=>a(t),class:"input"},null,40,Ot),[[w,t.title]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":s=>t.url=s,onBlur:s=>a(t),class:"input"},null,40,Dt),[[w,t.url]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":s=>t.logo=s,onBlur:s=>a(t),class:"input",placeholder:"logo链接(可选)"},null,40,Et),[[w,t.logo]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:s=>r(t.id)},"删除",8,Kt)])]))),128))])])])]))}},Gt=F(qt,[["__scopeId","data-v-f280329a"]]),Wt={class:"user-manage"},Jt={class:"user-card"},Qt={class:"password-section"},Xt={class:"password-form"},Yt={class:"form-group"},Zt={class:"form-group"},el={class:"form-group"},tl={class:"form-actions"},ll=["disabled"],sl={__name:"UserManage",setup(C){const l=m(""),d=m(""),i=m(""),v=m(!1),p=m(""),h=m("success"),a=m({});z(()=>y(null,null,function*(){try{const c=yield fe();a.value=c.data}catch(c){console.error("获取用户信息失败:",c)}}));function r(){return y(this,null,function*(){var c,t;if(!l.value||!d.value||!i.value){k("请填写所有密码字段","error");return}if(d.value!==i.value){k("两次输入的新密码不一致","error");return}if(d.value.length<6){k("新密码长度至少6位","error");return}v.value=!0,p.value="";try{yield we(l.value,d.value),k("密码修改成功","success"),l.value="",d.value="",i.value=""}catch(s){k(((t=(c=s.response)==null?void 0:c.data)==null?void 0:t.message)||"密码修改失败","error")}finally{v.value=!1}})}function k(c,t){p.value=c,h.value=t,c==="密码修改成功"&&t==="success"?setTimeout(()=>{p.value="2秒后自动退出登录,请使用新密码重新登录...",setTimeout(()=>{localStorage.removeItem("token"),window.location.reload()},2e3)},500):setTimeout(()=>{p.value=""},3e3)}return(c,t)=>(g(),f("div",Wt,[t[7]||(t[7]=e("div",{class:"user-header"},null,-1)),e("div",Jt,[e("div",Qt,[t[6]||(t[6]=e("h3",{class:"section-title"},"修改密码",-1)),e("div",Xt,[e("div",Yt,[t[3]||(t[3]=e("label",null,"当前密码：",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),type:"password",placeholder:"请输入当前密码",class:"input"},null,512),[[w,l.value]])]),e("div",Zt,[t[4]||(t[4]=e("label",null,"新密码：",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>d.value=s),type:"password",placeholder:"请输入新密码",class:"input"},null,512),[[w,d.value]])]),e("div",el,[t[5]||(t[5]=e("label",null,"确认新密码：",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.value=s),type:"password",placeholder:"请再次输入新密码",class:"input"},null,512),[[w,i.value]])]),e("div",tl,[e("button",{onClick:r,class:"btn",disabled:v.value},U(v.value?"修改中...":"修改密码"),9,ll)]),p.value?(g(),f("p",{key:0,class:I(["message",h.value])},U(p.value),3)):B("",!0)])])])]))}},nl=F(sl,[["__scopeId","data-v-85ce40f4"]]),al={class:"backup-manage"},ol={class:"backup-card"},il=["disabled"],ul={class:"backup-card import-card"},dl={class:"import-controls"},rl=["disabled"],cl={key:0,class:"file-name"},vl={__name:"BackupManage",setup(C){const l=m(!1),d=m(!1),i=m(null),v=m(null),p=m(""),h=m("success");function a(){return y(this,null,function*(){var c,t;l.value=!0,p.value="";try{const s=yield ke(),o=s.headers["content-disposition"];let x="nav-backup.json";if(o){const b=o.split(";").find(n=>n.trim().startsWith("filename="));b&&(x=b.split("=")[1].trim().replace(/"/g,""))}const $=window.URL.createObjectURL(new Blob([s.data])),M=document.createElement("a");M.href=$,M.setAttribute("download",x),document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL($),p.value="导出成功！",h.value="success"}catch(s){console.error("导出失败:",s),p.value="导出失败: "+(((t=(c=s.response)==null?void 0:c.data)==null?void 0:t.error)||s.message),h.value="error"}finally{l.value=!1}})}function r(c){i.value=c.target.files[0]||null,p.value=""}function k(){return y(this,null,function*(){var t,s;if(!i.value){alert("请先选择一个 .json 备份文件。");return}if(prompt(`这是一个极度危险的操作，将清空所有数据！

请输入 "确认导入" 来继续：`)!=="确认导入"){alert("操作已取消。");return}d.value=!0,p.value="正在导入...",h.value="success";try{const o=new FormData;o.append("backupFile",i.value);const x=yield $e(o);p.value=x.data.message||"导入成功！请刷新页面查看新数据。",h.value="success",i.value=null,v.value&&(v.value.value=""),alert("导入成功！您的所有数据已被覆盖。建议您刷新整个后台页面。")}catch(o){console.error("导入失败:",o),p.value="导入失败: "+(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.error)||o.message),h.value="error"}finally{d.value=!1}})}return(c,t)=>(g(),f("div",al,[e("div",ol,[t[0]||(t[0]=P('<h2 class="card-title" data-v-ce816363><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2566d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-ce816363><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-ce816363></path><polyline points="7 10 12 15 17 10" data-v-ce816363></polyline><line x1="12" y1="15" x2="12" y2="3" data-v-ce816363></line></svg> 导出备份 </h2><p class="card-desc" data-v-ce816363> 点击下面的按钮，将您当前的所有数据（包括栏目、卡片、用户、广告和友链）下载为一个 `backup.json` 文件。 请妥善保管这个文件。 </p>',2)),e("button",{class:"btn",onClick:a,disabled:l.value},U(l.value?"正在导出...":"导出现有数据"),9,il)]),e("div",ul,[t[1]||(t[1]=P('<h2 class="card-title" data-v-ce816363><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-ce816363><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-ce816363></path><polyline points="7 10 12 5 17 10" data-v-ce816363></polyline><line x1="12" y1="5" x2="12" y2="21" data-v-ce816363></line></svg> 导入备份 (危险操作) </h2><p class="card-desc warning" data-v-ce816363><strong data-v-ce816363>警告：</strong> 导入备份文件将会**彻底清空并覆盖**当前数据库中的所有数据！此操作不可逆，请在导入前确认您已备份好当前数据。 </p>',2)),e("div",dl,[e("input",{type:"file",onChange:r,accept:".json",ref_key:"fileInput",ref:v,class:"file-input"},null,544),e("button",{class:"btn btn-danger",onClick:k,disabled:!i.value||d.value},U(d.value?"正在导入...":"导入并覆盖"),9,rl)]),i.value?(g(),f("p",cl," 已选择文件: "+U(i.value.name),1)):B("",!0),p.value?(g(),f("div",{key:1,class:I(["message",h.value])},U(p.value),3)):B("",!0)])]))}},pl=F(vl,[["__scopeId","data-v-ce816363"]]),ml={class:"settings-manage"},gl={class:"settings-card"},hl={class:"form-group"},bl={class:"form-group"},_l={class:"form-group"},fl={for:"bg_opacity"},wl={class:"form-group"},kl={for:"glass_opacity"},$l={class:"form-group"},yl={class:"form-actions"},Ml=["disabled"],Cl={__name:"SiteSettings",setup(C){const l=m({bg_url_pc:"",bg_url_mobile:"",bg_opacity:.15,glass_opacity:.7,custom_css:"/* 自定义样式 */"}),d=m(!1),i=m(""),v=m("success");z(()=>y(null,null,function*(){d.value=!0;try{const h=yield ye();l.value=N(N({},l.value),h.data);const a=parseFloat(l.value.bg_opacity);l.value.bg_opacity=isNaN(a)?.15:a;const r=parseFloat(l.value.glass_opacity);l.value.glass_opacity=isNaN(r)?.7:r}catch(h){i.value="加载设置失败: "+h.message,v.value="error"}finally{d.value=!1}}));function p(){return y(this,null,function*(){var h,a;d.value=!0,i.value="";try{const r=H(N({},l.value),{bg_opacity:String(l.value.bg_opacity),glass_opacity:String(l.value.glass_opacity)});yield Me(r),i.value="设置已成功保存！",v.value="success",setTimeout(()=>{i.value=""},3e3)}catch(r){i.value="保存失败: "+(((a=(h=r.response)==null?void 0:h.data)==null?void 0:a.error)||r.message),v.value="error",setTimeout(()=>{i.value=""},5e3)}finally{d.value=!1}})}return(h,a)=>(g(),f("div",ml,[e("div",gl,[a[13]||(a[13]=e("h2",{class:"card-title"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m-8-4V7l8-4m0 14l8-4"})]),T(" 网站外观设置 ")],-1)),a[14]||(a[14]=e("p",{class:"card-desc"}," 在这里设置您网站的背景图、透明度和自定义CSS。 ",-1)),e("div",hl,[a[5]||(a[5]=e("label",{for:"bg_pc"},"电脑端 (PC) 背景图 URL",-1)),_(e("input",{id:"bg_pc","onUpdate:modelValue":a[0]||(a[0]=r=>l.value.bg_url_pc=r),placeholder:"https://example.com/pc_background.jpg",class:"input"},null,512),[[w,l.value.bg_url_pc]]),a[6]||(a[6]=e("p",{class:"input-hint"},"推荐横屏图片 (例如 1920x1080)。",-1))]),e("div",bl,[a[7]||(a[7]=e("label",{for:"bg_mobile"},"移动端背景图 URL",-1)),_(e("input",{id:"bg_mobile","onUpdate:modelValue":a[1]||(a[1]=r=>l.value.bg_url_mobile=r),placeholder:"https://example.com/mobile_background.jpg",class:"input"},null,512),[[w,l.value.bg_url_mobile]]),a[8]||(a[8]=e("p",{class:"input-hint"},"推荐竖屏图片 (例如 1080x1920)。如果留空，手机将使用默认背景图。",-1))]),e("div",_l,[e("label",fl," 背景蒙版透明度: "+U(Number(l.value.bg_opacity).toFixed(2)),1),_(e("input",{id:"bg_opacity",type:"range","onUpdate:modelValue":a[2]||(a[2]=r=>l.value.bg_opacity=r),min:"0.0",max:"1.0",step:"0.01",class:"slider"},null,512),[[w,l.value.bg_opacity,void 0,{number:!0}]]),a[9]||(a[9]=e("p",{class:"input-hint"},"值越大，背景图片越清晰，内容可能越难看清。",-1))]),e("div",wl,[e("label",kl," 毛玻璃透明度: "+U(Number(l.value.glass_opacity).toFixed(2)),1),_(e("input",{id:"glass_opacity",type:"range","onUpdate:modelValue":a[3]||(a[3]=r=>l.value.glass_opacity=r),min:"0.0",max:"1.0",step:"0.01",class:"slider"},null,512),[[w,l.value.glass_opacity,void 0,{number:!0}]]),a[10]||(a[10]=e("p",{class:"input-hint"},"值越小，毛玻璃越透明。推荐 0.6 ~ 0.8。 (控制菜单栏、卡片、搜索框)",-1))]),e("div",$l,[a[11]||(a[11]=e("label",{for:"custom_css"},"自定义 CSS",-1)),_(e("textarea",{id:"custom_css","onUpdate:modelValue":a[4]||(a[4]=r=>l.value.custom_css=r),placeholder:`/* 您的自定义样式 */
body {
  /* 示例: 更改背景 */
  /* background-color: #f0f0f0 !important; */
}`,class:"input textarea",rows:"10"},null,512),[[w,l.value.custom_css]]),a[12]||(a[12]=e("p",{class:"input-hint"},"您在这里编写的CSS将被应用到网站的每一个页面。",-1))]),e("div",yl,[e("button",{class:"btn",onClick:p,disabled:d.value},U(d.value?"保存中...":"保存设置"),9,Ml)]),i.value?(g(),f("div",{key:0,class:I(["message",v.value])},U(i.value),3)):B("",!0)])]))}},Ul=F(Cl,[["__scopeId","data-v-6b6763cc"]]),Vl={key:0,class:"login-container"},xl={class:"login-card"},Bl={class:"login-form"},Sl={class:"password-input-wrapper"},Il=["type"],Ll={key:0,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Al={key:1,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Fl={class:"login-buttons"},jl=["disabled"],Tl={key:0,class:"login-error"},zl={key:1,class:"admin-layout"},Nl={class:"menu-list"},Pl={class:"admin-main"},Hl={class:"admin-header"},Rl={class:"header-title"},Ol={class:"admin-content"},Dl={key:0,class:"welcome-page"},El={class:"welcome-cards"},Kl={class:"welcome-card"},ql={class:"welcome-value"},Gl={class:"welcome-card"},Wl={class:"welcome-value"},Jl={__name:"Admin",setup(C){const l=m("welcome"),d=m(""),i=m(""),v=m(!1),p=m(""),h=m(""),a=m(!1),r=m(""),k=m(!1),c=m(!1),t=q(()=>{switch(l.value){case"menu":return"栏目管理";case"card":return"卡片管理";case"ad":return"广告管理";case"friend":return"友链管理";case"user":return"用户管理";case"backup":return"数据备份与恢复";case"settings":return"网站外观设置";default:return""}});z(()=>{const b=localStorage.getItem("token");v.value=!!b,v.value&&s()});function s(){return y(this,null,function*(){try{const b=yield fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(b.ok){const n=yield b.json();d.value=n.last_login_time||"",i.value=n.last_login_ip||""}}catch(b){console.error("获取用户信息失败:",b)}})}function o(){return y(this,null,function*(){var b,n;if(!p.value||!h.value){r.value="请输入用户名和密码";return}a.value=!0,r.value="";try{const u=yield Ce(p.value,h.value);u.data.token&&(localStorage.setItem("token",u.data.token),v.value=!0,d.value=u.data.lastLoginTime||"",i.value=u.data.lastLoginIp||"")}catch(u){r.value=((n=(b=u.response)==null?void 0:b.data)==null?void 0:n.message)||"登录失败，请检查用户名和密码"}finally{a.value=!1}})}function x(){localStorage.removeItem("token"),v.value=!1,p.value="",h.value="",r.value=""}function $(){window.open("/","_blank")}function M(){c.value=!c.value}function S(){c.value=!1}return(b,n)=>v.value?(g(),f("div",zl,[e("aside",{class:I(["admin-sider",{open:c.value}]),onClick:G(S,["self"])},[e("div",{class:"logo clickable",onClick:n[3]||(n[3]=u=>{l.value="welcome",S()})},"Admin"),e("ul",Nl,[e("li",{class:I({active:l.value==="menu"}),onClick:n[4]||(n[4]=u=>{l.value="menu",S()})},"栏目管理",2),e("li",{class:I({active:l.value==="card"}),onClick:n[5]||(n[5]=u=>{l.value="card",S()})},"卡片管理",2),e("li",{class:I({active:l.value==="ad"}),onClick:n[6]||(n[6]=u=>{l.value="ad",S()})},"广告管理",2),e("li",{class:I({active:l.value==="friend"}),onClick:n[7]||(n[7]=u=>{l.value="friend",S()})},"友链管理",2),n[15]||(n[15]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:I({active:l.value==="settings"}),onClick:n[8]||(n[8]=u=>{l.value="settings",S()})},"网站外观设置",2),e("li",{class:I({active:l.value==="backup"}),onClick:n[9]||(n[9]=u=>{l.value="backup",S()})},"数据备份与恢复",2),n[16]||(n[16]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:I({active:l.value==="user"}),onClick:n[10]||(n[10]=u=>{l.value="user",S()})},"用户管理",2)])],2),e("main",Pl,[e("div",Hl,[e("button",{class:"menu-toggle",onClick:M}," ☰ "),e("div",Rl,U(t.value),1),e("div",{class:"header-actions"},[e("span",{class:"home-icon",onClick:$,title:"进入主页"},n[17]||(n[17]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-4h-4v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10.5z",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),e("button",{class:"btn logout-btn",onClick:x},"退出登录")])]),e("div",Ol,[l.value==="welcome"?(g(),f("div",Dl,[n[20]||(n[20]=e("h2",{class:"welcome-title"},"欢迎您进入 Nav-Item 后台管理系统",-1)),e("div",El,[e("div",Kl,[n[18]||(n[18]=P('<div class="welcome-icon time-icon" data-v-4eebe4f3><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-4eebe4f3><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-4eebe4f3></circle><path d="M12 6v6l4 2" stroke="#1abc9c" stroke-width="2" stroke-linecap="round" data-v-4eebe4f3></path></svg></div><div class="welcome-label" data-v-4eebe4f3>上次登录时间</div>',2)),e("div",ql,U(d.value||"--"),1)]),e("div",Gl,[n[19]||(n[19]=P('<div class="welcome-icon ip-icon" data-v-4eebe4f3><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-4eebe4f3><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-4eebe4f3></circle><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8z" stroke="#1abc9c" stroke-width="2" data-v-4eebe4f3></path><circle cx="12" cy="12" r="2" fill="#1abc9c" data-v-4eebe4f3></circle></svg></div><div class="welcome-label" data-v-4eebe4f3>上次登录IP</div>',2)),e("div",Wl,U(i.value||"--"),1)])])])):B("",!0),l.value==="menu"?(g(),j(Ye,{key:1})):B("",!0),l.value==="card"?(g(),j(kt,{key:2})):B("",!0),l.value==="ad"?(g(),j(zt,{key:3})):B("",!0),l.value==="friend"?(g(),j(Gt,{key:4})):B("",!0),l.value==="user"?(g(),j(nl,{key:5})):B("",!0),l.value==="backup"?(g(),j(pl,{key:6})):B("",!0),l.value==="settings"?(g(),j(Ul,{key:7})):B("",!0)]),n[21]||(n[21]=e("footer",{class:"admin-footer"},[e("p",{class:"admin-copyright"},[T("Copyright © 2025 Nav-Item | "),e("a",{href:"https://github.com/eooce/Nav-Item",target:"_blank",class:"footer-link"},"Powered by eooce")])],-1))])])):(g(),f("div",Vl,[e("div",xl,[n[14]||(n[14]=e("h2",{class:"login-title"},"后台管理登录",-1)),e("div",Bl,[_(e("input",{"onUpdate:modelValue":n[0]||(n[0]=u=>p.value=u),type:"text",placeholder:"用户名",class:"login-input",onKeyup:K(o,["enter"])},null,544),[[w,p.value]]),e("div",Sl,[_(e("input",{"onUpdate:modelValue":n[1]||(n[1]=u=>h.value=u),type:k.value?"text":"password",placeholder:"密码",class:"login-input password-input",onKeyup:K(o,["enter"])},null,40,Il),[[ee,h.value]]),e("span",{class:"toggle-password",onClick:n[2]||(n[2]=u=>k.value=!k.value)},[k.value?(g(),f("svg",Ll,n[11]||(n[11]=[e("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(g(),f("svg",Al,n[12]||(n[12]=[e("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.77 21.77 0 0 1 5.06-6.06"},null,-1),e("path",{d:"M1 1l22 22"},null,-1),e("path",{d:"M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47"},null,-1)])))])]),e("div",Fl,[e("button",{onClick:$,class:"back-btn"},n[13]||(n[13]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),T(" 返回首页 ")])),e("button",{onClick:o,class:"login-btn",disabled:a.value},U(a.value?"登录中...":"登录"),9,jl)]),r.value?(g(),f("p",Tl,U(r.value),1)):B("",!0)])])]))}},Zl=F(Jl,[["__scopeId","data-v-4eebe4f3"]]);export{Zl as default};
