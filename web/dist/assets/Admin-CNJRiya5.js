var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var D=(U,l,i)=>l in U?X(U,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):U[l]=i,W=(U,l)=>{for(var i in l||(l={}))ee.call(l,i)&&D(U,i,l[i]);if(O)for(var i of O(l))te.call(l,i)&&D(U,i,l[i]);return U},K=(U,l)=>Y(U,Z(l));var M=(U,l,i)=>new Promise((a,p)=>{var u=w=>{try{g(i.next(w))}catch(k){p(k)}},o=w=>{try{g(i.throw(w))}catch(k){p(k)}},g=w=>w.done?a(w.value):Promise.resolve(w.value).then(u,o);g((i=i.apply(U,l)).next())});import{_ as z,r as v,e as T,c as f,o as m,b as e,l as _,v as b,p as N,F as A,a as F,n as L,t as B,i as J,f as R,q as E,w as G,d as I,s as H,u as le,m as q,x as ne,y as j}from"./index-B0S5j3Sj.js";import{a as Q,f as oe,u as se,h as ae,i as ie,j as ue,k as de,l as re,m as ce,n as ve,d as pe,b as me,o as ge,p as he,q as _e,c as fe,r as be,s as we,t as ke,v as ye,w as $e,x as Me,y as Ce,g as xe,z as Ue,A as Ve}from"./api-CPdfUet4.js";const Be={class:"menu-manage"},Se={class:"menu-header"},Ie={class:"menu-add"},Le={class:"menu-content"},Ae={class:"menu-list"},Fe={class:"main-menu"},ze={class:"menu-info"},je=["onUpdate:modelValue","onBlur"],Te={class:"menu-order"},Ne=["onUpdate:modelValue","onBlur"],Pe={class:"menu-actions"},Ee=["onClick","title"],He=["onClick"],Re={class:"sub-menu-header"},Oe={class:"sub-menu-title"},De=["onClick"],We={key:0,class:"sub-menu-list"},Ke={class:"sub-menu-info"},qe=["onUpdate:modelValue","onBlur"],Je={class:"sub-menu-order"},Ge=["onUpdate:modelValue","onBlur"],Qe={class:"sub-menu-actions"},Xe=["onClick"],Ye={key:1,class:"empty-sub-menu"},Ze=["onClick"],et={__name:"MenuManage",setup(U){const l=v([]),i=v("");T(a);function a(){return M(this,null,function*(){const t=yield Q(),n=l.value||[];l.value=t.data.map(s=>{const S=n.find($=>$.id===s.id);return K(W({},s),{showSubMenu:S?!!S.showSubMenu:!1})})})}function p(){return M(this,null,function*(){if(!i.value.trim())return;const t=l.value.length?Math.max(...l.value.map(n=>n.order||0)):0;yield oe({name:i.value.trim(),order:t+1}),i.value="",a()})}function u(t){return M(this,null,function*(){yield se(t.id,{name:t.name,order:t.order}),a()})}function o(t){return M(this,null,function*(){confirm("确定要删除这个主菜单吗？删除后将同时删除其下的所有子菜单和卡片。")&&(yield ae(t),a())})}function g(t){return M(this,null,function*(){var $;const n=l.value.find(x=>x.id===t),s=prompt("请输入子菜单名称：");if(!(s!=null&&s.trim()))return;const S=($=n.subMenus)!=null&&$.length?Math.max(...n.subMenus.map(x=>x.order||0)):0;yield ie(t,{name:s.trim(),order:S+1}),a()})}function w(t){return M(this,null,function*(){yield ue(t.id,{name:t.name,order:t.order}),a()})}function k(t){return M(this,null,function*(){confirm("确定要删除这个子菜单吗？删除后将同时删除其下的所有卡片。")&&(yield de(t),a())})}function c(t){const n=l.value.find(s=>s.id===t);n&&(n.showSubMenu=!n.showSubMenu)}return(t,n)=>(m(),f("div",Be,[e("div",Se,[n[2]||(n[2]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理主菜单和子菜单")],-1)),e("div",Ie,[_(e("input",{"onUpdate:modelValue":n[0]||(n[0]=s=>i.value=s),placeholder:"请输入主菜单名称",class:"input"},null,512),[[b,i.value]]),e("button",{class:"btn btn-primary",onClick:p},n[1]||(n[1]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),N(" 添加主菜单 ")]))])]),e("div",Le,[e("div",Ae,[(m(!0),f(A,null,F(l.value,s=>{var S;return m(),f("div",{key:s.id,class:"menu-item"},[e("div",Fe,[e("div",ze,[n[4]||(n[4]=e("div",{class:"menu-icon"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 3h18v18H3zM9 9h6v6H9z"})])],-1)),_(e("input",{"onUpdate:modelValue":$=>s.name=$,onBlur:$=>u(s),class:"menu-name-input"},null,40,je),[[b,s.name]]),e("div",Te,[n[3]||(n[3]=e("span",{class:"order-label"},"排序",-1)),_(e("input",{"onUpdate:modelValue":$=>s.order=$,type:"number",onBlur:$=>u(s),class:"order-input"},null,40,Ne),[[b,s.order,void 0,{number:!0}]])])]),e("div",Pe,[e("button",{class:"btn btn-icon expand-btn",onClick:$=>c(s.id),title:s.showSubMenu?"收起子菜单":"展开子菜单"},n[5]||(n[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m6 9 6 6 6-6"})],-1)]),8,Ee),e("button",{class:"btn btn-danger btn-icon",onClick:$=>o(s.id),title:"删除主菜单"},n[6]||(n[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,He)])]),e("div",{class:L(["sub-menu-section",{expanded:s.showSubMenu}])},[e("div",Re,[e("div",Oe,[n[7]||(n[7]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 11H1l8-8 8 8h-8v8z"})],-1)),N(" 子菜单 ("+B(((S=s.subMenus)==null?void 0:S.length)||0)+") ",1)]),e("button",{class:"btn btn-sm btn-outline",onClick:$=>g(s.id)},n[8]||(n[8]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),N(" 添加子菜单 ")]),8,De)]),s.subMenus&&s.subMenus.length>0?(m(),f("div",We,[(m(!0),f(A,null,F(s.subMenus,$=>(m(),f("div",{key:$.id,class:"sub-menu-item"},[e("div",Ke,[n[9]||(n[9]=e("div",{class:"sub-menu-icon"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 6h16M4 12h16M4 18h16"})])],-1)),_(e("input",{"onUpdate:modelValue":x=>$.name=x,onBlur:x=>w($),class:"sub-menu-name-input"},null,40,qe),[[b,$.name]]),e("div",Je,[_(e("input",{"onUpdate:modelValue":x=>$.order=x,type:"number",onBlur:x=>w($),class:"order-input"},null,40,Ge),[[b,$.order,void 0,{number:!0}]])])]),e("div",Qe,[e("button",{class:"btn btn-danger btn-icon btn-sm",onClick:x=>k($.id),title:"删除子菜单"},n[10]||(n[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 22 22",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,Xe)])]))),128))])):(m(),f("div",Ye,[n[11]||(n[11]=e("p",null,"暂无子菜单",-1)),e("button",{class:"btn btn-sm btn-outline",onClick:$=>g(s.id)},"添加第一个子菜单",8,Ze)]))],2)])}),128))])])]))}},tt=z(et,[["__scopeId","data-v-2ff9bea5"]]),lt={class:"card-manage"},nt={class:"card-header"},ot={class:"card-add"},st=["value"],at=["value"],it={class:"input-with-icon header-icon-input"},ut={class:"card-card"},dt={class:"card-table"},rt=["onUpdate:modelValue","onBlur"],ct=["onUpdate:modelValue","onBlur"],vt={class:"input-with-icon"},pt=["onUpdate:modelValue","onBlur"],mt=["onClick"],gt=["onUpdate:modelValue","onBlur"],ht=["onUpdate:modelValue","onBlur"],_t={class:"td-actions"},ft=["onClick"],bt={__name:"CardManage",setup(U){const l=v([]),i=v([]),a=v(),p=v(""),u=v(""),o=v(""),g=v(""),w=J(()=>{if(!a.value)return[];const y=l.value.find(h=>h.id===a.value);return(y==null?void 0:y.subMenus)||[]});T(()=>M(null,null,function*(){const y=yield Q();l.value=y.data,l.value.length&&(a.value=l.value[0].id,p.value="")})),R(a,()=>{p.value="",t()}),R(p,t);function k(){p.value=""}function c(){t()}function t(){return M(this,null,function*(){if(!a.value)return;const y=yield pe(a.value,p.value||null);i.value=y.data})}function n(){return M(this,null,function*(){!u.value||!o.value||(yield re({menu_id:a.value,sub_menu_id:p.value||null,title:u.value,url:o.value,logo_url:g.value}),u.value="",o.value="",g.value="",t())})}function s(y){return M(this,null,function*(){yield ce(y.id,{menu_id:a.value,sub_menu_id:p.value||null,title:y.title,url:y.url,logo_url:y.logo_url,desc:y.desc,order:y.order})})}function S(y){return M(this,null,function*(){yield ve(y),t()})}function $(y){if(!y)return null;try{let h=y;return/^https?:\/\//i.test(h)||(h="http://"+h),new URL(h).hostname.replace(/^www\./i,"")}catch(h){return console.error("URL 格式无效: ",h),null}}function x(){const y=$(o.value);y?g.value=`https://www.faviconextractor.com/favicon/${y}?larger=true`:alert("请先在“卡片链接”中输入有效的 URL")}function P(y){return M(this,null,function*(){const h=$(y.url);if(h){y.logo_url=`https://www.faviconextractor.com/favicon/${h}?larger=true`;try{yield s(y)}catch(d){console.error("自动保存图标失败:",d),alert("获取图标成功，但自动保存失败。")}}else alert("此卡片的 URL 无效，无法获取图标。")})}return(y,h)=>(m(),f("div",lt,[e("div",nt,[h[8]||(h[8]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理网站导航卡片，支持主菜单和子菜单分类")],-1)),e("div",ot,[_(e("select",{"onUpdate:modelValue":h[0]||(h[0]=d=>a.value=d),class:"input",onChange:k},[(m(!0),f(A,null,F(l.value,d=>(m(),f("option",{value:d.id,key:d.id},B(d.name),9,st))),128))],544),[[E,a.value]]),_(e("select",{"onUpdate:modelValue":h[1]||(h[1]=d=>p.value=d),class:"input",onChange:c},[h[5]||(h[5]=e("option",{value:""},"主菜单",-1)),(m(!0),f(A,null,F(w.value,d=>(m(),f("option",{value:d.id,key:d.id},B(d.name),9,at))),128))],544),[[E,p.value]]),_(e("input",{"onUpdate:modelValue":h[2]||(h[2]=d=>u.value=d),placeholder:"卡片标题",class:"input"},null,512),[[b,u.value]]),_(e("input",{"onUpdate:modelValue":h[3]||(h[3]=d=>o.value=d),placeholder:"卡片链接",class:"input"},null,512),[[b,o.value]]),e("div",it,[_(e("input",{"onUpdate:modelValue":h[4]||(h[4]=d=>g.value=d),placeholder:"logo链接(可选)",class:"input"},null,512),[[b,g.value]]),e("button",{class:"btn btn-icon btn-magic",onClick:x,title:"自动获取图标"},h[6]||(h[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]))]),e("button",{class:"btn btn-block",onClick:n},h[7]||(h[7]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),N(" 添加卡片 ")]))])]),e("div",ut,[e("table",dt,[h[11]||(h[11]=e("thead",null,[e("tr",null,[e("th",null,"标题"),e("th",null,"网址"),e("th",null,"Logo链接"),e("th",null,"描述"),e("th",null,"排序"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),f(A,null,F(i.value,d=>(m(),f("tr",{key:d.id},[e("td",null,[_(e("input",{"onUpdate:modelValue":C=>d.title=C,onBlur:C=>s(d),class:"table-input"},null,40,rt),[[b,d.title]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":C=>d.url=C,onBlur:C=>s(d),class:"table-input"},null,40,ct),[[b,d.url]])]),e("td",null,[e("div",vt,[_(e("input",{"onUpdate:modelValue":C=>d.logo_url=C,onBlur:C=>s(d),class:"table-input",placeholder:"logo链接(可选)"},null,40,pt),[[b,d.logo_url]]),e("button",{class:"btn btn-icon btn-magic",onClick:C=>P(d),title:"自动获取图标"},h[9]||(h[9]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]),8,mt)])]),e("td",null,[_(e("input",{"onUpdate:modelValue":C=>d.desc=C,onBlur:C=>s(d),class:"table-input",placeholder:"描述（可选）"},null,40,gt),[[b,d.desc]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":C=>d.order=C,type:"number",onBlur:C=>s(d),class:"table-input order-input"},null,40,ht),[[b,d.order,void 0,{number:!0}]])]),e("td",_t,[e("button",{class:"btn btn-danger btn-icon",onClick:C=>S(d.id),title:"删除"},h[10]||(h[10]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,ft)])]))),128))])])])]))}},wt=z(bt,[["__scopeId","data-v-123dcf5e"]]),kt={class:"ad-manage"},yt={class:"ad-header"},$t={class:"ad-section"},Mt={class:"ad-card"},Ct={class:"ad-table"},xt=["onUpdate:modelValue","onBlur"],Ut=["onUpdate:modelValue","onBlur"],Vt=["onClick"],Bt={class:"ad-section"},St={class:"ad-card"},It={class:"ad-table"},Lt=["onUpdate:modelValue","onBlur"],At=["onUpdate:modelValue","onBlur"],Ft=["onClick"],zt={__name:"AdManage",setup(U){const l=v([]),i=v([]),a=v(""),p=v(""),u=v("left");T(o);function o(){return M(this,null,function*(){const c=yield me();l.value=c.data.filter(t=>t.position==="left"),i.value=c.data.filter(t=>t.position==="right")})}function g(){return M(this,null,function*(){!a.value||!p.value||(yield ge({position:u.value,img:a.value,url:p.value}),a.value="",p.value="",u.value="left",o())})}function w(c){return M(this,null,function*(){yield he(c.id,{img:c.img,url:c.url}),o()})}function k(c){return M(this,null,function*(){yield _e(c),o()})}return(c,t)=>(m(),f("div",kt,[e("div",yt,[e("form",{class:"ad-add-row",onSubmit:G(g,["prevent"])},[_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>a.value=n),placeholder:"广告图片链接",class:"input"},null,512),[[b,a.value]]),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>p.value=n),placeholder:"广告跳转链接",class:"input"},null,512),[[b,p.value]]),_(e("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>u.value=n),class:"input select-input"},t[3]||(t[3]=[e("option",{value:"left"},"左侧广告",-1),e("option",{value:"right"},"右侧广告",-1)]),512),[[E,u.value]]),t[4]||(t[4]=e("button",{class:"btn",type:"submit"},"添加广告",-1))],32)]),e("div",$t,[t[6]||(t[6]=e("h3",{class:"section-title"},"左侧广告列表",-1)),e("div",Mt,[e("table",Ct,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),f(A,null,F(l.value,n=>(m(),f("tr",{key:n.id},[e("td",null,[_(e("input",{"onUpdate:modelValue":s=>n.img=s,onBlur:s=>w(n),class:"input"},null,40,xt),[[b,n.img]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":s=>n.url=s,onBlur:s=>w(n),class:"input"},null,40,Ut),[[b,n.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:s=>k(n.id)},"删除广告",8,Vt)])]))),128))])])])]),e("div",Bt,[t[8]||(t[8]=e("h3",{class:"section-title"},"右侧广告列表",-1)),e("div",St,[e("table",It,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),f(A,null,F(i.value,n=>(m(),f("tr",{key:n.id},[e("td",null,[_(e("input",{"onUpdate:modelValue":s=>n.img=s,onBlur:s=>w(n),class:"input"},null,40,Lt),[[b,n.img]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":s=>n.url=s,onBlur:s=>w(n),class:"input"},null,40,At),[[b,n.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:s=>k(n.id)},"删除广告",8,Ft)])]))),128))])])])])]))}},jt=z(zt,[["__scopeId","data-v-780b5e23"]]),Tt={class:"friend-manage"},Nt={class:"friend-add"},Pt={class:"friend-card"},Et={class:"friend-table"},Ht=["onUpdate:modelValue","onBlur"],Rt=["onUpdate:modelValue","onBlur"],Ot=["onUpdate:modelValue","onBlur"],Dt=["onClick"],Wt={__name:"FriendLinkManage",setup(U){const l=v([]),i=v(""),a=v(""),p=v("");T(u);function u(){return M(this,null,function*(){const k=yield fe();l.value=k.data})}function o(){return M(this,null,function*(){!i.value||!a.value||(yield be({title:i.value,url:a.value,logo:p.value}),i.value="",a.value="",p.value="",u())})}function g(k){return M(this,null,function*(){yield we(k.id,{title:k.title,url:k.url,logo:k.logo}),u()})}function w(k){return M(this,null,function*(){yield ke(k),u()})}return(k,c)=>(m(),f("div",Tt,[c[4]||(c[4]=e("div",{class:"friend-header"},null,-1)),e("div",Nt,[_(e("input",{"onUpdate:modelValue":c[0]||(c[0]=t=>i.value=t),placeholder:"网站名",class:"input"},null,512),[[b,i.value]]),_(e("input",{"onUpdate:modelValue":c[1]||(c[1]=t=>a.value=t),placeholder:"网站链接",class:"input"},null,512),[[b,a.value]]),_(e("input",{"onUpdate:modelValue":c[2]||(c[2]=t=>p.value=t),placeholder:"logo链接(可选)",class:"input"},null,512),[[b,p.value]]),e("button",{class:"btn",onClick:o},"添加友链")]),e("div",Pt,[e("table",Et,[c[3]||(c[3]=e("thead",null,[e("tr",null,[e("th",null,"网站名"),e("th",null,"链接"),e("th",null,"Logo"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),f(A,null,F(l.value,t=>(m(),f("tr",{key:t.id},[e("td",null,[_(e("input",{"onUpdate:modelValue":n=>t.title=n,onBlur:n=>g(t),class:"input"},null,40,Ht),[[b,t.title]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":n=>t.url=n,onBlur:n=>g(t),class:"input"},null,40,Rt),[[b,t.url]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":n=>t.logo=n,onBlur:n=>g(t),class:"input",placeholder:"logo链接(可选)"},null,40,Ot),[[b,t.logo]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:n=>w(t.id)},"删除",8,Dt)])]))),128))])])])]))}},Kt=z(Wt,[["__scopeId","data-v-f280329a"]]),qt={class:"user-manage"},Jt={class:"user-card"},Gt={class:"password-section"},Qt={class:"password-form"},Xt={class:"form-group"},Yt={class:"form-group"},Zt={class:"form-group"},el={class:"form-actions"},tl=["disabled"],ll={__name:"UserManage",setup(U){const l=v(""),i=v(""),a=v(""),p=v(!1),u=v(""),o=v("success"),g=v({});T(()=>M(null,null,function*(){try{const c=yield ye();g.value=c.data}catch(c){console.error("获取用户信息失败:",c)}}));function w(){return M(this,null,function*(){var c,t;if(!l.value||!i.value||!a.value){k("请填写所有密码字段","error");return}if(i.value!==a.value){k("两次输入的新密码不一致","error");return}if(i.value.length<6){k("新密码长度至少6位","error");return}p.value=!0,u.value="";try{yield $e(l.value,i.value),k("密码修改成功","success"),l.value="",i.value="",a.value=""}catch(n){k(((t=(c=n.response)==null?void 0:c.data)==null?void 0:t.message)||"密码修改失败","error")}finally{p.value=!1}})}function k(c,t){u.value=c,o.value=t,c==="密码修改成功"&&t==="success"?setTimeout(()=>{u.value="2秒后自动退出登录,请使用新密码重新登录...",setTimeout(()=>{localStorage.removeItem("token"),window.location.reload()},2e3)},500):setTimeout(()=>{u.value=""},3e3)}return(c,t)=>(m(),f("div",qt,[t[7]||(t[7]=e("div",{class:"user-header"},null,-1)),e("div",Jt,[e("div",Gt,[t[6]||(t[6]=e("h3",{class:"section-title"},"修改密码",-1)),e("div",Qt,[e("div",Xt,[t[3]||(t[3]=e("label",null,"当前密码：",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>l.value=n),type:"password",placeholder:"请输入当前密码",class:"input"},null,512),[[b,l.value]])]),e("div",Yt,[t[4]||(t[4]=e("label",null,"新密码：",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>i.value=n),type:"password",placeholder:"请输入新密码",class:"input"},null,512),[[b,i.value]])]),e("div",Zt,[t[5]||(t[5]=e("label",null,"确认新密码：",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>a.value=n),type:"password",placeholder:"请再次输入新密码",class:"input"},null,512),[[b,a.value]])]),e("div",el,[e("button",{onClick:w,class:"btn",disabled:p.value},B(p.value?"修改中...":"修改密码"),9,tl)]),u.value?(m(),f("p",{key:0,class:L(["message",o.value])},B(u.value),3)):I("",!0)])])])]))}},nl=z(ll,[["__scopeId","data-v-85ce40f4"]]),ol={class:"backup-manage"},sl={class:"backup-card"},al=["disabled"],il={class:"backup-card import-card"},ul={class:"import-controls"},dl=["disabled"],rl={key:0,class:"file-name"},cl={__name:"BackupManage",setup(U){const l=v(!1),i=v(!1),a=v(null),p=v(null),u=v(""),o=v("success");function g(){return M(this,null,function*(){var c,t;l.value=!0,u.value="";try{const n=yield Me(),s=n.headers["content-disposition"];let S="nav-backup.json";if(s){const y=s.split(";").find(h=>h.trim().startsWith("filename="));y&&(S=y.split("=")[1].trim().replace(/"/g,""))}const $=window.URL.createObjectURL(new Blob([n.data])),x=document.createElement("a");x.href=$,x.setAttribute("download",S),document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL($),u.value="导出成功！",o.value="success"}catch(n){console.error("导出失败:",n),u.value="导出失败: "+(((t=(c=n.response)==null?void 0:c.data)==null?void 0:t.error)||n.message),o.value="error"}finally{l.value=!1}})}function w(c){a.value=c.target.files[0]||null,u.value=""}function k(){return M(this,null,function*(){var t,n;if(!a.value){alert("请先选择一个 .json 备份文件。");return}if(prompt(`这是一个极度危险的操作，将清空所有数据！

请输入 "确认导入" 来继续：`)!=="确认导入"){alert("操作已取消。");return}i.value=!0,u.value="正在导入...",o.value="success";try{const s=new FormData;s.append("backupFile",a.value);const S=yield Ce(s);u.value=S.data.message||"导入成功！请刷新页面查看新数据。",o.value="success",a.value=null,p.value&&(p.value.value=""),alert("导入成功！您的所有数据已被覆盖。建议您刷新整个后台页面。")}catch(s){console.error("导入失败:",s),u.value="导入失败: "+(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.error)||s.message),o.value="error"}finally{i.value=!1}})}return(c,t)=>(m(),f("div",ol,[e("div",sl,[t[0]||(t[0]=H('<h2 class="card-title" data-v-ce816363><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2566d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-ce816363><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-ce816363></path><polyline points="7 10 12 15 17 10" data-v-ce816363></polyline><line x1="12" y1="15" x2="12" y2="3" data-v-ce816363></line></svg> 导出备份 </h2><p class="card-desc" data-v-ce816363> 点击下面的按钮，将您当前的所有数据（包括栏目、卡片、用户、广告和友链）下载为一个 `backup.json` 文件。 请妥善保管这个文件。 </p>',2)),e("button",{class:"btn",onClick:g,disabled:l.value},B(l.value?"正在导出...":"导出现有数据"),9,al)]),e("div",il,[t[1]||(t[1]=H('<h2 class="card-title" data-v-ce816363><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-ce816363><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-ce816363></path><polyline points="7 10 12 5 17 10" data-v-ce816363></polyline><line x1="12" y1="5" x2="12" y2="21" data-v-ce816363></line></svg> 导入备份 (危险操作) </h2><p class="card-desc warning" data-v-ce816363><strong data-v-ce816363>警告：</strong> 导入备份文件将会**彻底清空并覆盖**当前数据库中的所有数据！此操作不可逆，请在导入前确认您已备份好当前数据。 </p>',2)),e("div",ul,[e("input",{type:"file",onChange:w,accept:".json",ref_key:"fileInput",ref:p,class:"file-input"},null,544),e("button",{class:"btn btn-danger",onClick:k,disabled:!a.value||i.value},B(i.value?"正在导入...":"导入并覆盖"),9,dl)]),a.value?(m(),f("p",rl," 已选择文件: "+B(a.value.name),1)):I("",!0),u.value?(m(),f("div",{key:1,class:L(["message",o.value])},B(u.value),3)):I("",!0)])]))}},vl=z(cl,[["__scopeId","data-v-ce816363"]]),pl={class:"site-settings"},ml={class:"settings-card"},gl={class:"form-row"},hl={class:"form-row"},_l={class:"form-row"},fl={class:"range-row"},bl={class:"range-value"},wl={class:"form-row"},kl={class:"range-row"},yl={class:"range-value"},$l={class:"form-row"},Ml={class:"form-row"},Cl={class:"form-actions"},xl=["disabled"],Ul={key:0,class:"save-message"},Vl={__name:"SiteSettings",setup(U){const l=v({bg_url_pc:"",bg_url_mobile:"",bg_opacity:1,glass_opacity:1,custom_css:"",text_color_mode:"auto"}),i=v(!1),a=v("");T(()=>M(null,null,function*(){try{const o=(yield xe()).data||{};l.value.bg_url_pc=o.bg_url_pc||"",l.value.bg_url_mobile=o.bg_url_mobile||"",l.value.custom_css=o.custom_css||"",l.value.text_color_mode=o.text_color_mode||"auto";const g=parseFloat(o.bg_opacity);l.value.bg_opacity=isNaN(g)?1:g;const w=parseFloat(o.glass_opacity);l.value.glass_opacity=isNaN(w)?1:w}catch(u){console.error("加载设置失败",u)}}));function p(){return M(this,null,function*(){if(!i.value){i.value=!0,a.value="";try{const u={bg_url_pc:l.value.bg_url_pc,bg_url_mobile:l.value.bg_url_mobile,bg_opacity:String(l.value.bg_opacity),glass_opacity:String(l.value.glass_opacity),custom_css:l.value.custom_css,text_color_mode:l.value.text_color_mode};yield Ue(u),a.value="已保存",setTimeout(()=>{a.value=""},2e3)}catch(u){console.error("保存设置失败",u),a.value="保存失败，请稍后再试"}finally{i.value=!1}}})}return(u,o)=>(m(),f("div",pl,[e("div",ml,[e("div",gl,[o[6]||(o[6]=e("label",{class:"form-label"},"PC 端背景图片地址",-1)),_(e("input",{"onUpdate:modelValue":o[0]||(o[0]=g=>l.value.bg_url_pc=g),type:"text",class:"input",placeholder:"例如：https://example.com/bg-pc.jpg"},null,512),[[b,l.value.bg_url_pc]])]),e("div",hl,[o[7]||(o[7]=e("label",{class:"form-label"},"移动端背景图片地址",-1)),_(e("input",{"onUpdate:modelValue":o[1]||(o[1]=g=>l.value.bg_url_mobile=g),type:"text",class:"input",placeholder:"例如：https://example.com/bg-mobile.jpg"},null,512),[[b,l.value.bg_url_mobile]])]),e("div",_l,[o[8]||(o[8]=e("label",{class:"form-label"},"背景蒙版透明度（0 - 1）",-1)),e("div",fl,[_(e("input",{"onUpdate:modelValue":o[2]||(o[2]=g=>l.value.bg_opacity=g),type:"range",min:"0",max:"1",step:"0.01",class:"range-input"},null,512),[[b,l.value.bg_opacity,void 0,{number:!0}]]),e("span",bl,B(l.value.bg_opacity.toFixed(2)),1)])]),e("div",wl,[o[9]||(o[9]=e("label",{class:"form-label"},"卡片毛玻璃透明度（0 - 1）",-1)),e("div",kl,[_(e("input",{"onUpdate:modelValue":o[3]||(o[3]=g=>l.value.glass_opacity=g),type:"range",min:"0",max:"1",step:"0.01",class:"range-input"},null,512),[[b,l.value.glass_opacity,void 0,{number:!0}]]),e("span",yl,B(l.value.glass_opacity.toFixed(2)),1)])]),e("div",$l,[o[11]||(o[11]=e("label",{class:"form-label"},"字体颜色模式",-1)),_(e("select",{"onUpdate:modelValue":o[4]||(o[4]=g=>l.value.text_color_mode=g),class:"select"},o[10]||(o[10]=[e("option",{value:"auto"},"自动（根据背景蒙版透明度）",-1),e("option",{value:"black"},"始终黑色",-1),e("option",{value:"white"},"始终白色",-1)]),512),[[E,l.value.text_color_mode]])]),e("div",Ml,[o[12]||(o[12]=e("label",{class:"form-label"},"自定义 CSS",-1)),_(e("textarea",{"onUpdate:modelValue":o[5]||(o[5]=g=>l.value.custom_css=g),class:"textarea",rows:"8",placeholder:`可以在这里写自定义 CSS，例如：\r
.home-container { font-size: 15px; }`},null,512),[[b,l.value.custom_css]])]),e("div",Cl,[e("button",{class:"btn primary",onClick:p,disabled:i.value},B(i.value?"保存中...":"保存设置"),9,xl),a.value?(m(),f("span",Ul,B(a.value),1)):I("",!0)])])]))}},Bl=z(Vl,[["__scopeId","data-v-b558abfb"]]),Sl={class:"login-card"},Il={class:"login-form"},Ll={class:"password-input-wrapper"},Al=["type"],Fl={key:0,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},zl={key:1,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},jl=["disabled"],Tl={key:0,class:"login-error"},Nl={key:1,class:"admin-layout"},Pl={class:"menu-list"},El={class:"admin-main"},Hl={class:"admin-header"},Rl={class:"header-title"},Ol={class:"admin-content"},Dl={key:0,class:"welcome-page"},Wl={class:"welcome-cards"},Kl={class:"welcome-card"},ql={class:"welcome-value"},Jl={class:"welcome-card"},Gl={class:"welcome-value"},Ql={__name:"Admin",setup(U){const l=v("welcome"),i=v(""),a=v(""),p=v(!1),u=v(""),o=v(""),g=v(!1),w=v(""),k=v(!1),c=v(!1),t=v(!1),n=J(()=>{switch(l.value){case"menu":return"栏目管理";case"card":return"卡片管理";case"ad":return"广告管理";case"friend":return"友链管理";case"user":return"用户管理";case"backup":return"数据备份与恢复";case"settings":return"网站外观设置";default:return""}});function s(){typeof window!="undefined"&&(t.value&&!p.value?(document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"):(document.documentElement.style.overflow="",document.body.style.overflow=""))}function S(){if(typeof window=="undefined")return;const C=t.value;t.value=window.innerWidth<=768,t.value!==C&&s()}T(()=>{typeof window!="undefined"&&(t.value=window.innerWidth<=768,window.addEventListener("resize",S));const C=localStorage.getItem("token");p.value=!!C,p.value&&$(),s()}),le(()=>{typeof window!="undefined"&&window.removeEventListener("resize",S),document.documentElement.style.overflow="",document.body.style.overflow=""}),R(p,()=>{s()});function $(){return M(this,null,function*(){try{const C=yield fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(C.ok){const r=yield C.json();i.value=r.last_login_time||"",a.value=r.last_login_ip||""}}catch(C){console.error("获取用户信息失败:",C)}})}function x(){return M(this,null,function*(){var C,r;if(!u.value||!o.value){w.value="请输入用户名和密码";return}g.value=!0,w.value="";try{const V=yield Ve(u.value,o.value);V.data.token&&(localStorage.setItem("token",V.data.token),p.value=!0,i.value=V.data.lastLoginTime||"",a.value=V.data.lastLoginIp||"")}catch(V){w.value=((r=(C=V.response)==null?void 0:C.data)==null?void 0:r.message)||"登录失败，请检查用户名和密码"}finally{g.value=!1}})}function P(){localStorage.removeItem("token"),p.value=!1,u.value="",o.value="",w.value=""}function y(){window.location.href="/"}function h(){c.value=!c.value}function d(){typeof window!="undefined"&&window.innerWidth<=768&&(c.value=!1)}return(C,r)=>p.value?(m(),f("div",Nl,[c.value?(m(),f("div",{key:0,class:"sider-mask",onClick:d})):I("",!0),e("aside",{class:L(["admin-sider",{open:c.value}]),onClick:G(d,["self"])},[e("div",{class:"logo clickable",onClick:r[3]||(r[3]=V=>{l.value="welcome",d()})},"Admin"),e("ul",Pl,[e("li",{class:L({active:l.value==="menu"}),onClick:r[4]||(r[4]=V=>{l.value="menu",d()})},"栏目管理",2),e("li",{class:L({active:l.value==="card"}),onClick:r[5]||(r[5]=V=>{l.value="card",d()})},"卡片管理",2),e("li",{class:L({active:l.value==="ad"}),onClick:r[6]||(r[6]=V=>{l.value="ad",d()})},"广告管理",2),e("li",{class:L({active:l.value==="friend"}),onClick:r[7]||(r[7]=V=>{l.value="friend",d()})},"友链管理",2),r[15]||(r[15]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:L({active:l.value==="settings"}),onClick:r[8]||(r[8]=V=>{l.value="settings",d()})},"网站外观设置",2),e("li",{class:L({active:l.value==="backup"}),onClick:r[9]||(r[9]=V=>{l.value="backup",d()})},"数据备份与恢复",2),r[16]||(r[16]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:L({active:l.value==="user"}),onClick:r[10]||(r[10]=V=>{l.value="user",d()})},"用户管理",2)])],2),e("main",El,[e("div",Hl,[e("button",{class:"menu-toggle",onClick:h}," ☰ "),e("div",Rl,B(n.value),1),e("div",{class:"header-actions"},[e("span",{class:"home-icon",onClick:y,title:"进入主页"},r[17]||(r[17]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-4h-4v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10.5z",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),e("button",{class:"btn logout-btn",onClick:P},"退出登录")])]),e("div",Ol,[l.value==="welcome"?(m(),f("div",Dl,[r[20]||(r[20]=e("h2",{class:"welcome-title"},"欢迎您进入 Nav-Item 后台管理系统",-1)),e("div",Wl,[e("div",Kl,[r[18]||(r[18]=H('<div class="welcome-icon time-icon" data-v-26d99494><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-26d99494><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-26d99494></circle><path d="M12 6v6l4 2" stroke="#1abc9c" stroke-width="2" stroke-linecap="round" data-v-26d99494></path></svg></div><div class="welcome-label" data-v-26d99494>上次登录时间</div>',2)),e("div",ql,B(i.value||"--"),1)]),e("div",Jl,[r[19]||(r[19]=H('<div class="welcome-icon ip-icon" data-v-26d99494><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-26d99494><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-26d99494></circle><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8z" stroke="#1abc9c" stroke-width="2" data-v-26d99494></path><circle cx="12" cy="12" r="2" fill="#1abc9c" data-v-26d99494></circle></svg></div><div class="welcome-label" data-v-26d99494>上次登录IP</div>',2)),e("div",Gl,B(a.value||"--"),1)])])])):I("",!0),l.value==="menu"?(m(),j(tt,{key:1})):I("",!0),l.value==="card"?(m(),j(wt,{key:2})):I("",!0),l.value==="ad"?(m(),j(jt,{key:3})):I("",!0),l.value==="friend"?(m(),j(Kt,{key:4})):I("",!0),l.value==="user"?(m(),j(nl,{key:5})):I("",!0),l.value==="backup"?(m(),j(vl,{key:6})):I("",!0),l.value==="settings"?(m(),j(Bl,{key:7})):I("",!0)]),r[21]||(r[21]=e("footer",{class:"admin-footer"},[e("p",{class:"admin-copyright"},[N(" Copyright © 2025 Nav-Item | "),e("a",{href:"https://github.com/LeoJyenn/Nav-Item",target:"_blank",class:"footer-link"},"Powered by LeoJyenn")])],-1))])])):(m(),f("div",{key:0,class:L(["login-container",{"mobile-login":t.value}])},[e("div",Sl,[r[14]||(r[14]=e("h2",{class:"login-title"},"后台管理登录",-1)),e("div",Il,[_(e("input",{"onUpdate:modelValue":r[0]||(r[0]=V=>u.value=V),type:"text",placeholder:"用户名",class:"login-input",onKeyup:q(x,["enter"])},null,544),[[b,u.value]]),e("div",Ll,[_(e("input",{"onUpdate:modelValue":r[1]||(r[1]=V=>o.value=V),type:k.value?"text":"password",placeholder:"密码",class:"login-input password-input",onKeyup:q(x,["enter"])},null,40,Al),[[ne,o.value]]),e("span",{class:"toggle-password",onClick:r[2]||(r[2]=V=>k.value=!k.value)},[k.value?(m(),f("svg",Fl,r[11]||(r[11]=[e("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(m(),f("svg",zl,r[12]||(r[12]=[e("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.77 21.77 0 0 1 5.06-6.06"},null,-1),e("path",{d:"M1 1l22 22"},null,-1),e("path",{d:"M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47"},null,-1)])))])]),e("div",{class:L(["login-buttons",{"mobile-stack":t.value}])},[e("button",{onClick:y,class:"back-btn"},r[13]||(r[13]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),N(" 返回首页 ")])),e("button",{onClick:x,class:"login-btn",disabled:g.value},B(g.value?"登录中...":"登录"),9,jl)],2),w.value?(m(),f("p",Tl,B(w.value),1)):I("",!0)])])],2))}},en=z(Ql,[["__scopeId","data-v-26d99494"]]);export{en as default};
