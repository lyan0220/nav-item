var W=Object.defineProperty,G=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var R=(C,n,u)=>n in C?W(C,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):C[n]=u,D=(C,n)=>{for(var u in n||(n={}))X.call(n,u)&&R(C,u,n[u]);if(N)for(var u of N(n))Y.call(n,u)&&R(C,u,n[u]);return C},E=(C,n)=>G(C,Q(n));var $=(C,n,u)=>new Promise((d,c)=>{var o=k=>{try{y(u.next(k))}catch(f){c(f)}},v=k=>{try{y(u.throw(k))}catch(f){c(f)}},y=k=>k.done?d(k.value):Promise.resolve(k.value).then(o,v);y((u=u.apply(C,n)).next())});import{_ as j,r as p,e as z,c as _,o as m,b as e,l as h,v as b,p as P,F as L,a as A,n as I,t as x,i as q,f as O,q as T,w as Z,d as B,s as H,m as K,u as ee,x as F}from"./index-LJHrggcl.js";import{a as J,f as te,u as le,h as ne,i as se,j as oe,k as ae,l as ie,m as ue,n as de,d as re,b as ce,o as ve,p as pe,q as me,c as ge,r as he,s as _e,t as be,v as fe,w as we,x as ke,y as $e,g as ye,z as Me,A as Ce}from"./api-CPdfUet4.js";const Ue={class:"menu-manage"},Ve={class:"menu-header"},xe={class:"menu-add"},Be={class:"menu-content"},Se={class:"menu-list"},Ie={class:"main-menu"},Le={class:"menu-info"},Ae=["onUpdate:modelValue","onBlur"],je={class:"menu-order"},Fe=["onUpdate:modelValue","onBlur"],ze={class:"menu-actions"},Pe=["onClick","title"],Te=["onClick"],He={class:"sub-menu-header"},Ne={class:"sub-menu-title"},Re=["onClick"],De={key:0,class:"sub-menu-list"},Ee={class:"sub-menu-info"},Oe=["onUpdate:modelValue","onBlur"],Ke={class:"sub-menu-order"},qe=["onUpdate:modelValue","onBlur"],Je={class:"sub-menu-actions"},We=["onClick"],Ge={key:1,class:"empty-sub-menu"},Qe=["onClick"],Xe={__name:"MenuManage",setup(C){const n=p([]),u=p("");z(d);function d(){return $(this,null,function*(){const t=yield J(),l=n.value||[];n.value=t.data.map(a=>{const U=l.find(w=>w.id===a.id);return E(D({},a),{showSubMenu:U?!!U.showSubMenu:!1})})})}function c(){return $(this,null,function*(){if(!u.value.trim())return;const t=n.value.length?Math.max(...n.value.map(l=>l.order||0)):0;yield te({name:u.value.trim(),order:t+1}),u.value="",d()})}function o(t){return $(this,null,function*(){yield le(t.id,{name:t.name,order:t.order}),d()})}function v(t){return $(this,null,function*(){confirm("确定要删除这个主菜单吗？删除后将同时删除其下的所有子菜单和卡片。")&&(yield ne(t),d())})}function y(t){return $(this,null,function*(){var w;const l=n.value.find(M=>M.id===t),a=prompt("请输入子菜单名称：");if(!(a!=null&&a.trim()))return;const U=(w=l.subMenus)!=null&&w.length?Math.max(...l.subMenus.map(M=>M.order||0)):0;yield se(t,{name:a.trim(),order:U+1}),d()})}function k(t){return $(this,null,function*(){yield oe(t.id,{name:t.name,order:t.order}),d()})}function f(t){return $(this,null,function*(){confirm("确定要删除这个子菜单吗？删除后将同时删除其下的所有卡片。")&&(yield ae(t),d())})}function r(t){const l=n.value.find(a=>a.id===t);l&&(l.showSubMenu=!l.showSubMenu)}return(t,l)=>(m(),_("div",Ue,[e("div",Ve,[l[2]||(l[2]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理主菜单和子菜单")],-1)),e("div",xe,[h(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>u.value=a),placeholder:"请输入主菜单名称",class:"input"},null,512),[[b,u.value]]),e("button",{class:"btn btn-primary",onClick:c},l[1]||(l[1]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),P(" 添加主菜单 ")]))])]),e("div",Be,[e("div",Se,[(m(!0),_(L,null,A(n.value,a=>{var U;return m(),_("div",{key:a.id,class:"menu-item"},[e("div",Ie,[e("div",Le,[l[4]||(l[4]=e("div",{class:"menu-icon"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 3h18v18H3zM9 9h6v6H9z"})])],-1)),h(e("input",{"onUpdate:modelValue":w=>a.name=w,onBlur:w=>o(a),class:"menu-name-input"},null,40,Ae),[[b,a.name]]),e("div",je,[l[3]||(l[3]=e("span",{class:"order-label"},"排序",-1)),h(e("input",{"onUpdate:modelValue":w=>a.order=w,type:"number",onBlur:w=>o(a),class:"order-input"},null,40,Fe),[[b,a.order,void 0,{number:!0}]])])]),e("div",ze,[e("button",{class:"btn btn-icon expand-btn",onClick:w=>r(a.id),title:a.showSubMenu?"收起子菜单":"展开子菜单"},l[5]||(l[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m6 9 6 6 6-6"})],-1)]),8,Pe),e("button",{class:"btn btn-danger btn-icon",onClick:w=>v(a.id),title:"删除主菜单"},l[6]||(l[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,Te)])]),e("div",{class:I(["sub-menu-section",{expanded:a.showSubMenu}])},[e("div",He,[e("div",Ne,[l[7]||(l[7]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 11H1l8-8 8 8h-8v8z"})],-1)),P(" 子菜单 ("+x(((U=a.subMenus)==null?void 0:U.length)||0)+") ",1)]),e("button",{class:"btn btn-sm btn-outline",onClick:w=>y(a.id)},l[8]||(l[8]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),P(" 添加子菜单 ")]),8,Re)]),a.subMenus&&a.subMenus.length>0?(m(),_("div",De,[(m(!0),_(L,null,A(a.subMenus,w=>(m(),_("div",{key:w.id,class:"sub-menu-item"},[e("div",Ee,[l[9]||(l[9]=e("div",{class:"sub-menu-icon"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 6h16M4 12h16M4 18h16"})])],-1)),h(e("input",{"onUpdate:modelValue":M=>w.name=M,onBlur:M=>k(w),class:"sub-menu-name-input"},null,40,Oe),[[b,w.name]]),e("div",Ke,[h(e("input",{"onUpdate:modelValue":M=>w.order=M,type:"number",onBlur:M=>k(w),class:"order-input"},null,40,qe),[[b,w.order,void 0,{number:!0}]])])]),e("div",Je,[e("button",{class:"btn btn-danger btn-icon btn-sm",onClick:M=>f(w.id),title:"删除子菜单"},l[10]||(l[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 22 22",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,We)])]))),128))])):(m(),_("div",Ge,[l[11]||(l[11]=e("p",null,"暂无子菜单",-1)),e("button",{class:"btn btn-sm btn-outline",onClick:w=>y(a.id)},"添加第一个子菜单",8,Qe)]))],2)])}),128))])])]))}},Ye=j(Xe,[["__scopeId","data-v-2ff9bea5"]]),Ze={class:"card-manage"},et={class:"card-header"},tt={class:"card-add"},lt=["value"],nt=["value"],st={class:"input-with-icon header-icon-input"},ot={class:"card-card"},at={class:"card-table"},it=["onUpdate:modelValue","onBlur"],ut=["onUpdate:modelValue","onBlur"],dt={class:"input-with-icon"},rt=["onUpdate:modelValue","onBlur"],ct=["onClick"],vt=["onUpdate:modelValue","onBlur"],pt=["onUpdate:modelValue","onBlur"],mt={class:"td-actions"},gt=["onClick"],ht={__name:"CardManage",setup(C){const n=p([]),u=p([]),d=p(),c=p(""),o=p(""),v=p(""),y=p(""),k=q(()=>{if(!d.value)return[];const g=n.value.find(s=>s.id===d.value);return(g==null?void 0:g.subMenus)||[]});z(()=>$(null,null,function*(){const g=yield J();n.value=g.data,n.value.length&&(d.value=n.value[0].id,c.value="")})),O(d,()=>{c.value="",t()}),O(c,t);function f(){c.value=""}function r(){t()}function t(){return $(this,null,function*(){if(!d.value)return;const g=yield re(d.value,c.value||null);u.value=g.data})}function l(){return $(this,null,function*(){!o.value||!v.value||(yield ie({menu_id:d.value,sub_menu_id:c.value||null,title:o.value,url:v.value,logo_url:y.value}),o.value="",v.value="",y.value="",t())})}function a(g){return $(this,null,function*(){yield ue(g.id,{menu_id:d.value,sub_menu_id:c.value||null,title:g.title,url:g.url,logo_url:g.logo_url,desc:g.desc,order:g.order})})}function U(g){return $(this,null,function*(){yield de(g),t()})}function w(g){if(!g)return null;try{let s=g;return/^https?:\/\//i.test(s)||(s="http://"+s),new URL(s).hostname.replace(/^www\./i,"")}catch(s){return console.error("URL 格式无效: ",s),null}}function M(){const g=w(v.value);g?y.value=`https://www.faviconextractor.com/favicon/${g}?larger=true`:alert("请先在“卡片链接”中输入有效的 URL")}function S(g){return $(this,null,function*(){const s=w(g.url);if(s){g.logo_url=`https://www.faviconextractor.com/favicon/${s}?larger=true`;try{yield a(g)}catch(i){console.error("自动保存图标失败:",i),alert("获取图标成功，但自动保存失败。")}}else alert("此卡片的 URL 无效，无法获取图标。")})}return(g,s)=>(m(),_("div",Ze,[e("div",et,[s[8]||(s[8]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理网站导航卡片，支持主菜单和子菜单分类")],-1)),e("div",tt,[h(e("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>d.value=i),class:"input",onChange:f},[(m(!0),_(L,null,A(n.value,i=>(m(),_("option",{value:i.id,key:i.id},x(i.name),9,lt))),128))],544),[[T,d.value]]),h(e("select",{"onUpdate:modelValue":s[1]||(s[1]=i=>c.value=i),class:"input",onChange:r},[s[5]||(s[5]=e("option",{value:""},"主菜单",-1)),(m(!0),_(L,null,A(k.value,i=>(m(),_("option",{value:i.id,key:i.id},x(i.name),9,nt))),128))],544),[[T,c.value]]),h(e("input",{"onUpdate:modelValue":s[2]||(s[2]=i=>o.value=i),placeholder:"卡片标题",class:"input"},null,512),[[b,o.value]]),h(e("input",{"onUpdate:modelValue":s[3]||(s[3]=i=>v.value=i),placeholder:"卡片链接",class:"input"},null,512),[[b,v.value]]),e("div",st,[h(e("input",{"onUpdate:modelValue":s[4]||(s[4]=i=>y.value=i),placeholder:"logo链接(可选)",class:"input"},null,512),[[b,y.value]]),e("button",{class:"btn btn-icon btn-magic",onClick:M,title:"自动获取图标"},s[6]||(s[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]))]),e("button",{class:"btn btn-block",onClick:l},s[7]||(s[7]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),P(" 添加卡片 ")]))])]),e("div",ot,[e("table",at,[s[11]||(s[11]=e("thead",null,[e("tr",null,[e("th",null,"标题"),e("th",null,"网址"),e("th",null,"Logo链接"),e("th",null,"描述"),e("th",null,"排序"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),_(L,null,A(u.value,i=>(m(),_("tr",{key:i.id},[e("td",null,[h(e("input",{"onUpdate:modelValue":V=>i.title=V,onBlur:V=>a(i),class:"table-input"},null,40,it),[[b,i.title]])]),e("td",null,[h(e("input",{"onUpdate:modelValue":V=>i.url=V,onBlur:V=>a(i),class:"table-input"},null,40,ut),[[b,i.url]])]),e("td",null,[e("div",dt,[h(e("input",{"onUpdate:modelValue":V=>i.logo_url=V,onBlur:V=>a(i),class:"table-input",placeholder:"logo链接(可选)"},null,40,rt),[[b,i.logo_url]]),e("button",{class:"btn btn-icon btn-magic",onClick:V=>S(i),title:"自动获取图标"},s[9]||(s[9]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]),8,ct)])]),e("td",null,[h(e("input",{"onUpdate:modelValue":V=>i.desc=V,onBlur:V=>a(i),class:"table-input",placeholder:"描述（可选）"},null,40,vt),[[b,i.desc]])]),e("td",null,[h(e("input",{"onUpdate:modelValue":V=>i.order=V,type:"number",onBlur:V=>a(i),class:"table-input order-input"},null,40,pt),[[b,i.order,void 0,{number:!0}]])]),e("td",mt,[e("button",{class:"btn btn-danger btn-icon",onClick:V=>U(i.id),title:"删除"},s[10]||(s[10]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,gt)])]))),128))])])])]))}},_t=j(ht,[["__scopeId","data-v-123dcf5e"]]),bt={class:"ad-manage"},ft={class:"ad-header"},wt={class:"ad-section"},kt={class:"ad-card"},$t={class:"ad-table"},yt=["onUpdate:modelValue","onBlur"],Mt=["onUpdate:modelValue","onBlur"],Ct=["onClick"],Ut={class:"ad-section"},Vt={class:"ad-card"},xt={class:"ad-table"},Bt=["onUpdate:modelValue","onBlur"],St=["onUpdate:modelValue","onBlur"],It=["onClick"],Lt={__name:"AdManage",setup(C){const n=p([]),u=p([]),d=p(""),c=p(""),o=p("left");z(v);function v(){return $(this,null,function*(){const r=yield ce();n.value=r.data.filter(t=>t.position==="left"),u.value=r.data.filter(t=>t.position==="right")})}function y(){return $(this,null,function*(){!d.value||!c.value||(yield ve({position:o.value,img:d.value,url:c.value}),d.value="",c.value="",o.value="left",v())})}function k(r){return $(this,null,function*(){yield pe(r.id,{img:r.img,url:r.url}),v()})}function f(r){return $(this,null,function*(){yield me(r),v()})}return(r,t)=>(m(),_("div",bt,[e("div",ft,[e("form",{class:"ad-add-row",onSubmit:Z(y,["prevent"])},[h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>d.value=l),placeholder:"广告图片链接",class:"input"},null,512),[[b,d.value]]),h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>c.value=l),placeholder:"广告跳转链接",class:"input"},null,512),[[b,c.value]]),h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>o.value=l),class:"input select-input"},t[3]||(t[3]=[e("option",{value:"left"},"左侧广告",-1),e("option",{value:"right"},"右侧广告",-1)]),512),[[T,o.value]]),t[4]||(t[4]=e("button",{class:"btn",type:"submit"},"添加广告",-1))],32)]),e("div",wt,[t[6]||(t[6]=e("h3",{class:"section-title"},"左侧广告列表",-1)),e("div",kt,[e("table",$t,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),_(L,null,A(n.value,l=>(m(),_("tr",{key:l.id},[e("td",null,[h(e("input",{"onUpdate:modelValue":a=>l.img=a,onBlur:a=>k(l),class:"input"},null,40,yt),[[b,l.img]])]),e("td",null,[h(e("input",{"onUpdate:modelValue":a=>l.url=a,onBlur:a=>k(l),class:"input"},null,40,Mt),[[b,l.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:a=>f(l.id)},"删除广告",8,Ct)])]))),128))])])])]),e("div",Ut,[t[8]||(t[8]=e("h3",{class:"section-title"},"右侧广告列表",-1)),e("div",Vt,[e("table",xt,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),_(L,null,A(u.value,l=>(m(),_("tr",{key:l.id},[e("td",null,[h(e("input",{"onUpdate:modelValue":a=>l.img=a,onBlur:a=>k(l),class:"input"},null,40,Bt),[[b,l.img]])]),e("td",null,[h(e("input",{"onUpdate:modelValue":a=>l.url=a,onBlur:a=>k(l),class:"input"},null,40,St),[[b,l.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:a=>f(l.id)},"删除广告",8,It)])]))),128))])])])])]))}},At=j(Lt,[["__scopeId","data-v-780b5e23"]]),jt={class:"friend-manage"},Ft={class:"friend-add"},zt={class:"friend-card"},Pt={class:"friend-table"},Tt=["onUpdate:modelValue","onBlur"],Ht=["onUpdate:modelValue","onBlur"],Nt=["onUpdate:modelValue","onBlur"],Rt=["onClick"],Dt={__name:"FriendLinkManage",setup(C){const n=p([]),u=p(""),d=p(""),c=p("");z(o);function o(){return $(this,null,function*(){const f=yield ge();n.value=f.data})}function v(){return $(this,null,function*(){!u.value||!d.value||(yield he({title:u.value,url:d.value,logo:c.value}),u.value="",d.value="",c.value="",o())})}function y(f){return $(this,null,function*(){yield _e(f.id,{title:f.title,url:f.url,logo:f.logo}),o()})}function k(f){return $(this,null,function*(){yield be(f),o()})}return(f,r)=>(m(),_("div",jt,[r[4]||(r[4]=e("div",{class:"friend-header"},null,-1)),e("div",Ft,[h(e("input",{"onUpdate:modelValue":r[0]||(r[0]=t=>u.value=t),placeholder:"网站名",class:"input"},null,512),[[b,u.value]]),h(e("input",{"onUpdate:modelValue":r[1]||(r[1]=t=>d.value=t),placeholder:"网站链接",class:"input"},null,512),[[b,d.value]]),h(e("input",{"onUpdate:modelValue":r[2]||(r[2]=t=>c.value=t),placeholder:"logo链接(可选)",class:"input"},null,512),[[b,c.value]]),e("button",{class:"btn",onClick:v},"添加友链")]),e("div",zt,[e("table",Pt,[r[3]||(r[3]=e("thead",null,[e("tr",null,[e("th",null,"网站名"),e("th",null,"链接"),e("th",null,"Logo"),e("th",null,"操作")])],-1)),e("tbody",null,[(m(!0),_(L,null,A(n.value,t=>(m(),_("tr",{key:t.id},[e("td",null,[h(e("input",{"onUpdate:modelValue":l=>t.title=l,onBlur:l=>y(t),class:"input"},null,40,Tt),[[b,t.title]])]),e("td",null,[h(e("input",{"onUpdate:modelValue":l=>t.url=l,onBlur:l=>y(t),class:"input"},null,40,Ht),[[b,t.url]])]),e("td",null,[h(e("input",{"onUpdate:modelValue":l=>t.logo=l,onBlur:l=>y(t),class:"input",placeholder:"logo链接(可选)"},null,40,Nt),[[b,t.logo]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:l=>k(t.id)},"删除",8,Rt)])]))),128))])])])]))}},Et=j(Dt,[["__scopeId","data-v-f280329a"]]),Ot={class:"user-manage"},Kt={class:"user-card"},qt={class:"password-section"},Jt={class:"password-form"},Wt={class:"form-group"},Gt={class:"form-group"},Qt={class:"form-group"},Xt={class:"form-actions"},Yt=["disabled"],Zt={__name:"UserManage",setup(C){const n=p(""),u=p(""),d=p(""),c=p(!1),o=p(""),v=p("success"),y=p({});z(()=>$(null,null,function*(){try{const r=yield fe();y.value=r.data}catch(r){console.error("获取用户信息失败:",r)}}));function k(){return $(this,null,function*(){var r,t;if(!n.value||!u.value||!d.value){f("请填写所有密码字段","error");return}if(u.value!==d.value){f("两次输入的新密码不一致","error");return}if(u.value.length<6){f("新密码长度至少6位","error");return}c.value=!0,o.value="";try{yield we(n.value,u.value),f("密码修改成功","success"),n.value="",u.value="",d.value=""}catch(l){f(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.message)||"密码修改失败","error")}finally{c.value=!1}})}function f(r,t){o.value=r,v.value=t,r==="密码修改成功"&&t==="success"?setTimeout(()=>{o.value="2秒后自动退出登录,请使用新密码重新登录...",setTimeout(()=>{localStorage.removeItem("token"),window.location.reload()},2e3)},500):setTimeout(()=>{o.value=""},3e3)}return(r,t)=>(m(),_("div",Ot,[t[7]||(t[7]=e("div",{class:"user-header"},null,-1)),e("div",Kt,[e("div",qt,[t[6]||(t[6]=e("h3",{class:"section-title"},"修改密码",-1)),e("div",Jt,[e("div",Wt,[t[3]||(t[3]=e("label",null,"当前密码：",-1)),h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),type:"password",placeholder:"请输入当前密码",class:"input"},null,512),[[b,n.value]])]),e("div",Gt,[t[4]||(t[4]=e("label",null,"新密码：",-1)),h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),type:"password",placeholder:"请输入新密码",class:"input"},null,512),[[b,u.value]])]),e("div",Qt,[t[5]||(t[5]=e("label",null,"确认新密码：",-1)),h(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.value=l),type:"password",placeholder:"请再次输入新密码",class:"input"},null,512),[[b,d.value]])]),e("div",Xt,[e("button",{onClick:k,class:"btn",disabled:c.value},x(c.value?"修改中...":"修改密码"),9,Yt)]),o.value?(m(),_("p",{key:0,class:I(["message",v.value])},x(o.value),3)):B("",!0)])])])]))}},el=j(Zt,[["__scopeId","data-v-85ce40f4"]]),tl={class:"backup-manage"},ll={class:"backup-card"},nl=["disabled"],sl={class:"backup-card import-card"},ol={class:"import-controls"},al=["disabled"],il={key:0,class:"file-name"},ul={__name:"BackupManage",setup(C){const n=p(!1),u=p(!1),d=p(null),c=p(null),o=p(""),v=p("success");function y(){return $(this,null,function*(){var r,t;n.value=!0,o.value="";try{const l=yield ke(),a=l.headers["content-disposition"];let U="nav-backup.json";if(a){const g=a.split(";").find(s=>s.trim().startsWith("filename="));g&&(U=g.split("=")[1].trim().replace(/"/g,""))}const w=window.URL.createObjectURL(new Blob([l.data])),M=document.createElement("a");M.href=w,M.setAttribute("download",U),document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL(w),o.value="导出成功！",v.value="success"}catch(l){console.error("导出失败:",l),o.value="导出失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),v.value="error"}finally{n.value=!1}})}function k(r){d.value=r.target.files[0]||null,o.value=""}function f(){return $(this,null,function*(){var t,l;if(!d.value){alert("请先选择一个 .json 备份文件。");return}if(prompt(`这是一个极度危险的操作，将清空所有数据！

请输入 "确认导入" 来继续：`)!=="确认导入"){alert("操作已取消。");return}u.value=!0,o.value="正在导入...",v.value="success";try{const a=new FormData;a.append("backupFile",d.value);const U=yield $e(a);o.value=U.data.message||"导入成功！请刷新页面查看新数据。",v.value="success",d.value=null,c.value&&(c.value.value=""),alert("导入成功！您的所有数据已被覆盖。建议您刷新整个后台页面。")}catch(a){console.error("导入失败:",a),o.value="导入失败: "+(((l=(t=a.response)==null?void 0:t.data)==null?void 0:l.error)||a.message),v.value="error"}finally{u.value=!1}})}return(r,t)=>(m(),_("div",tl,[e("div",ll,[t[0]||(t[0]=H('<h2 class="card-title" data-v-ce816363><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2566d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-ce816363><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-ce816363></path><polyline points="7 10 12 15 17 10" data-v-ce816363></polyline><line x1="12" y1="15" x2="12" y2="3" data-v-ce816363></line></svg> 导出备份 </h2><p class="card-desc" data-v-ce816363> 点击下面的按钮，将您当前的所有数据（包括栏目、卡片、用户、广告和友链）下载为一个 `backup.json` 文件。 请妥善保管这个文件。 </p>',2)),e("button",{class:"btn",onClick:y,disabled:n.value},x(n.value?"正在导出...":"导出现有数据"),9,nl)]),e("div",sl,[t[1]||(t[1]=H('<h2 class="card-title" data-v-ce816363><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-ce816363><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-ce816363></path><polyline points="7 10 12 5 17 10" data-v-ce816363></polyline><line x1="12" y1="5" x2="12" y2="21" data-v-ce816363></line></svg> 导入备份 (危险操作) </h2><p class="card-desc warning" data-v-ce816363><strong data-v-ce816363>警告：</strong> 导入备份文件将会**彻底清空并覆盖**当前数据库中的所有数据！此操作不可逆，请在导入前确认您已备份好当前数据。 </p>',2)),e("div",ol,[e("input",{type:"file",onChange:k,accept:".json",ref_key:"fileInput",ref:c,class:"file-input"},null,544),e("button",{class:"btn btn-danger",onClick:f,disabled:!d.value||u.value},x(u.value?"正在导入...":"导入并覆盖"),9,al)]),d.value?(m(),_("p",il," 已选择文件: "+x(d.value.name),1)):B("",!0),o.value?(m(),_("div",{key:1,class:I(["message",v.value])},x(o.value),3)):B("",!0)])]))}},dl=j(ul,[["__scopeId","data-v-ce816363"]]),rl={class:"site-settings"},cl={class:"settings-content"},vl={class:"settings-section"},pl={class:"form-row"},ml={class:"form-row"},gl={class:"settings-section"},hl={class:"form-row"},_l={class:"form-row"},bl={class:"form-row"},fl={class:"settings-section"},wl={class:"form-row"},kl={class:"settings-actions"},$l=["disabled"],yl={__name:"SiteSettings",setup(C){const n=p({bg_url_pc:"",bg_url_mobile:"",bg_opacity:1,glass_opacity:1,custom_css:"",font_mode:"auto"}),u=p(!1);z(()=>$(null,null,function*(){try{const o=(yield ye()).data||{};n.value={bg_url_pc:o.bg_url_pc||"",bg_url_mobile:o.bg_url_mobile||"",bg_opacity:o.bg_opacity!==void 0?Number(o.bg_opacity):1,glass_opacity:o.glass_opacity!==void 0?Number(o.glass_opacity):1,custom_css:o.custom_css||"",font_mode:o.font_mode||"auto"}}catch(c){console.error("加载设置失败",c)}}));function d(){return $(this,null,function*(){if(!u.value){u.value=!0;try{yield Me({bg_url_pc:n.value.bg_url_pc,bg_url_mobile:n.value.bg_url_mobile,bg_opacity:n.value.bg_opacity,glass_opacity:n.value.glass_opacity,custom_css:n.value.custom_css,font_mode:n.value.font_mode}),alert("保存成功")}catch(c){console.error("保存设置失败",c),alert("保存失败，请稍后再试")}finally{u.value=!1}}})}return(c,o)=>(m(),_("div",rl,[o[16]||(o[16]=e("div",{class:"settings-header"},[e("h2",{class:"page-title"},"网站外观设置")],-1)),e("div",cl,[e("div",vl,[o[8]||(o[8]=e("h3",null,"背景图片设置",-1)),e("div",pl,[o[6]||(o[6]=e("label",null,"PC 背景图片 URL",-1)),h(e("input",{"onUpdate:modelValue":o[0]||(o[0]=v=>n.value.bg_url_pc=v),type:"text",class:"input",placeholder:"例如：https://example.com/bg-pc.jpg"},null,512),[[b,n.value.bg_url_pc]])]),e("div",ml,[o[7]||(o[7]=e("label",null,"移动端 背景图片 URL",-1)),h(e("input",{"onUpdate:modelValue":o[1]||(o[1]=v=>n.value.bg_url_mobile=v),type:"text",class:"input",placeholder:"例如：https://example.com/bg-mobile.jpg"},null,512),[[b,n.value.bg_url_mobile]])])]),e("div",gl,[o[13]||(o[13]=e("h3",null,"蒙版与毛玻璃",-1)),e("div",hl,[o[9]||(o[9]=e("label",null," 背景蒙版透明度（0~1，数值越小越暗） ",-1)),h(e("input",{"onUpdate:modelValue":o[2]||(o[2]=v=>n.value.bg_opacity=v),type:"number",step:"0.05",min:"0",max:"1",class:"input"},null,512),[[b,n.value.bg_opacity,void 0,{number:!0}]])]),e("div",_l,[o[10]||(o[10]=e("label",null," 卡片毛玻璃透明度（0~1） ",-1)),h(e("input",{"onUpdate:modelValue":o[3]||(o[3]=v=>n.value.glass_opacity=v),type:"number",step:"0.05",min:"0",max:"1",class:"input"},null,512),[[b,n.value.glass_opacity,void 0,{number:!0}]])]),e("div",bl,[o[12]||(o[12]=e("label",null,"全站字体颜色",-1)),h(e("select",{"onUpdate:modelValue":o[4]||(o[4]=v=>n.value.font_mode=v),class:"input"},o[11]||(o[11]=[e("option",{value:"auto"},"自动（跟随蒙版）",-1),e("option",{value:"dark"},"黑色",-1),e("option",{value:"light"},"白色",-1)]),512),[[T,n.value.font_mode]])])]),e("div",fl,[o[15]||(o[15]=e("h3",null,"自定义 CSS",-1)),e("div",wl,[o[14]||(o[14]=e("label",null,"全站自定义 CSS（会直接注入 <style>）",-1)),h(e("textarea",{"onUpdate:modelValue":o[5]||(o[5]=v=>n.value.custom_css=v),class:"textarea",rows:"8",placeholder:`例如：
.card-grid { border-radius: 16px; }`},null,512),[[b,n.value.custom_css]])])]),e("div",kl,[e("button",{class:"btn btn-primary",onClick:d,disabled:u.value},x(u.value?"保存中...":"保存设置"),9,$l)])])]))}},Ml=j(yl,[["__scopeId","data-v-d5a65ce3"]]),Cl={key:0,class:"login-container"},Ul={class:"login-card"},Vl={class:"login-form"},xl={class:"password-input-wrapper"},Bl=["type"],Sl={key:0,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Il={key:1,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ll={class:"login-buttons"},Al=["disabled"],jl={key:0,class:"login-error"},Fl={key:1,class:"admin-layout"},zl={class:"menu-list"},Pl={class:"admin-main"},Tl={class:"admin-header"},Hl={class:"header-title"},Nl={class:"admin-content"},Rl={key:0,class:"welcome-page"},Dl={class:"welcome-cards"},El={class:"welcome-card"},Ol={class:"welcome-value"},Kl={class:"welcome-card"},ql={class:"welcome-value"},Jl={__name:"Admin",setup(C){const n=p("welcome"),u=p(""),d=p(""),c=p(!1),o=p(""),v=p(""),y=p(!1),k=p(""),f=p(!1),r=p(!1),t=q(()=>{switch(n.value){case"menu":return"栏目管理";case"card":return"卡片管理";case"ad":return"广告管理";case"friend":return"友链管理";case"user":return"用户管理";case"backup":return"数据备份与恢复";case"settings":return"网站外观设置";default:return""}});z(()=>{const g=localStorage.getItem("token");c.value=!!g,c.value&&l()});function l(){return $(this,null,function*(){try{const g=yield fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(g.ok){const s=yield g.json();u.value=s.last_login_time||"",d.value=s.last_login_ip||""}}catch(g){console.error("获取用户信息失败:",g)}})}function a(){return $(this,null,function*(){var g,s;if(!o.value||!v.value){k.value="请输入用户名和密码";return}y.value=!0,k.value="";try{const i=yield Ce(o.value,v.value);i.data.token&&(localStorage.setItem("token",i.data.token),c.value=!0,u.value=i.data.lastLoginTime||"",d.value=i.data.lastLoginIp||"")}catch(i){k.value=((s=(g=i.response)==null?void 0:g.data)==null?void 0:s.message)||"登录失败，请检查用户名和密码"}finally{y.value=!1}})}function U(){localStorage.removeItem("token"),c.value=!1,o.value="",v.value="",k.value=""}function w(){window.open("/","_blank")}function M(){r.value=!r.value}function S(){r.value=!1}return(g,s)=>c.value?(m(),_("div",Fl,[e("aside",{class:I(["admin-sider",{open:r.value}])},[e("div",{class:"logo clickable",onClick:s[3]||(s[3]=i=>{n.value="welcome",S()})},"Admin"),e("ul",zl,[e("li",{class:I({active:n.value==="menu"}),onClick:s[4]||(s[4]=i=>{n.value="menu",S()})},"栏目管理",2),e("li",{class:I({active:n.value==="card"}),onClick:s[5]||(s[5]=i=>{n.value="card",S()})},"卡片管理",2),e("li",{class:I({active:n.value==="ad"}),onClick:s[6]||(s[6]=i=>{n.value="ad",S()})},"广告管理",2),e("li",{class:I({active:n.value==="friend"}),onClick:s[7]||(s[7]=i=>{n.value="friend",S()})},"友链管理",2),s[15]||(s[15]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:I({active:n.value==="settings"}),onClick:s[8]||(s[8]=i=>{n.value="settings",S()})},"网站外观设置",2),e("li",{class:I({active:n.value==="backup"}),onClick:s[9]||(s[9]=i=>{n.value="backup",S()})},"数据备份与恢复",2),s[16]||(s[16]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:I({active:n.value==="user"}),onClick:s[10]||(s[10]=i=>{n.value="user",S()})},"用户管理",2)])],2),r.value?(m(),_("div",{key:0,class:"sider-mask",onClick:S})):B("",!0),e("main",Pl,[e("div",Tl,[e("button",{class:"menu-toggle",onClick:M}," ☰ "),e("div",Hl,x(t.value),1),e("div",{class:"header-actions"},[e("span",{class:"home-icon",onClick:w,title:"进入主页"},s[17]||(s[17]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-4h-4v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10.5z",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),e("button",{class:"btn logout-btn",onClick:U},"退出登录")])]),e("div",Nl,[n.value==="welcome"?(m(),_("div",Rl,[s[20]||(s[20]=e("h2",{class:"welcome-title"},"欢迎您进入 Nav-Item 后台管理系统",-1)),e("div",Dl,[e("div",El,[s[18]||(s[18]=H('<div class="welcome-icon time-icon" data-v-05ac0553><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-05ac0553><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-05ac0553></circle><path d="M12 6v6l4 2" stroke="#1abc9c" stroke-width="2" stroke-linecap="round" data-v-05ac0553></path></svg></div><div class="welcome-label" data-v-05ac0553>上次登录时间</div>',2)),e("div",Ol,x(u.value||"--"),1)]),e("div",Kl,[s[19]||(s[19]=H('<div class="welcome-icon ip-icon" data-v-05ac0553><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-05ac0553><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-05ac0553></circle><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8z" stroke="#1abc9c" stroke-width="2" data-v-05ac0553></path><circle cx="12" cy="12" r="2" fill="#1abc9c" data-v-05ac0553></circle></svg></div><div class="welcome-label" data-v-05ac0553>上次登录IP</div>',2)),e("div",ql,x(d.value||"--"),1)])])])):B("",!0),n.value==="menu"?(m(),F(Ye,{key:1})):B("",!0),n.value==="card"?(m(),F(_t,{key:2})):B("",!0),n.value==="ad"?(m(),F(At,{key:3})):B("",!0),n.value==="friend"?(m(),F(Et,{key:4})):B("",!0),n.value==="user"?(m(),F(el,{key:5})):B("",!0),n.value==="backup"?(m(),F(dl,{key:6})):B("",!0),n.value==="settings"?(m(),F(Ml,{key:7})):B("",!0)]),s[21]||(s[21]=e("footer",{class:"admin-footer"},[e("p",{class:"admin-copyright"},[P("Copyright © 2025 Nav-Item | "),e("a",{href:"https://github.com/LeoJyenn/Nav-Item",target:"_blank",class:"footer-link"},"Powered by LeoJyenn")])],-1))])])):(m(),_("div",Cl,[e("div",Ul,[s[14]||(s[14]=e("h2",{class:"login-title"},"后台管理登录",-1)),e("div",Vl,[h(e("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>o.value=i),type:"text",placeholder:"用户名",class:"login-input",onKeyup:K(a,["enter"])},null,544),[[b,o.value]]),e("div",xl,[h(e("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>v.value=i),type:f.value?"text":"password",placeholder:"密码",class:"login-input password-input",onKeyup:K(a,["enter"])},null,40,Bl),[[ee,v.value]]),e("span",{class:"toggle-password",onClick:s[2]||(s[2]=i=>f.value=!f.value)},[f.value?(m(),_("svg",Sl,s[11]||(s[11]=[e("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(m(),_("svg",Il,s[12]||(s[12]=[e("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.77 21.77 0 0 1 5.06-6.06"},null,-1),e("path",{d:"M1 1l22 22"},null,-1),e("path",{d:"M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47"},null,-1)])))])]),e("div",Ll,[e("button",{onClick:w,class:"back-btn"},s[13]||(s[13]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),P(" 返回首页 ")])),e("button",{onClick:a,class:"login-btn",disabled:y.value},x(y.value?"登录中...":"登录"),9,Al)]),k.value?(m(),_("p",jl,x(k.value),1)):B("",!0)])])]))}},Xl=j(Jl,[["__scopeId","data-v-05ac0553"]]);export{Xl as default};
